name: Deploy Streamlit App to Hugging Face Spaces

on:
  push:
    branches:
      - app

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          lfs: true  # Indispensable pour que Git LFS fonctionne dans l'action

      - name: Set up Git
        run: |
          git config --global user.email "you@example.com"
          git config --global user.name "Your Name"

      - name: Pull Git LFS files
        run: |
          git lfs pull

      - name: Prepare deploy folder
        run: |
          mkdir deploy
          shopt -s extglob
          cp -r !(deploy|.git|.github) deploy/

      - name: Initialize Git repo for Hugging Face
        run: |
          cd deploy
          git init
          git lfs install
          git remote add origin https://ncsdecoopman:${{ secrets.HF_TOKEN }}@huggingface.co/spaces/ncsdecoopman/ExtremePrecipit
          git fetch origin main || echo "No remote branch yet"
          git checkout -b main
          git add .
          git commit -m "Deploy app to HF Space with real data"
          git push origin main --force

