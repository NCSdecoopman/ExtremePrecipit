{
  "cells": [
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "---\n",
        "title: \"Caractérisation et évolution des précipitations extrêmes horaires en France à partir d’un modèle régional de climat à convection profonde résolue\"\n",
        "\n",
        "lang: fr\n",
        "bibliography: bibliography.bib\n",
        "\n",
        "format:\n",
        "  pdf:\n",
        "    documentclass: article\n",
        "    papersize: a4\n",
        "    fontsize: 11pt\n",
        "    geometry:\n",
        "      - margin=1cm\n",
        "    number-sections: true\n",
        "    toc: false\n",
        "\n",
        "execute:\n",
        "  eval: true\n",
        "  echo: false\n",
        "  warning: false\n",
        "  error: false\n",
        "---\n",
        "\n",
        "*Les cartes étant rasterisées, il est possible d’appliquer un zoom à n’importe quel niveau afin de mieux distinguer les détails visuels. Toutefois, comme il s’agit de données en pixels et non vectorielles, un agrandissement trop important entraîne une perte de netteté et l’apparition de pixellisation.*\n",
        "\n",
        "\\small Repository : https://github.com/NCSdecoopman/ExtremePrecipit \\\n",
        "\\small Application : https://huggingface.co/spaces/ncsdecoopman/ExtremePrecipit"
      ],
      "id": "1b2c591c"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "from __future__ import annotations\n",
        "\n",
        "import sys\n",
        "import os\n",
        "from pathlib import Path\n",
        "from typing import Tuple\n",
        "\n",
        "import pandas as pd\n",
        "\n",
        "from svgutils.transform import fromfile, SVGFigure\n",
        "import cairosvg\n",
        "\n",
        "def _to_px(value: str | None) -> float:\n",
        "    \"\"\"\n",
        "    Convertit une longueur SVG (px, mm, cm, pt, in) en pixels (float).\n",
        "\n",
        "    Si `value` est None ou vide, retourne 0.\n",
        "    \"\"\"\n",
        "    if not value:\n",
        "        return 0.0\n",
        "    value = value.strip()\n",
        "    num = ''\n",
        "    unit = ''\n",
        "    for ch in value:\n",
        "        if ch.isdigit() or ch in '.-':\n",
        "            num += ch\n",
        "        else:\n",
        "            unit += ch\n",
        "    if not num:\n",
        "        return 0.0\n",
        "    numf = float(num)\n",
        "    unit = unit.strip().lower()\n",
        "    if unit in ('', 'px'):\n",
        "        return numf\n",
        "    if unit == 'mm':\n",
        "        return numf * 3.779527559055  # 96 dpi\n",
        "    if unit == 'cm':\n",
        "        return numf * 37.79527559055\n",
        "    if unit == 'in':\n",
        "        return numf * 96\n",
        "    if unit == 'pt':\n",
        "        return numf * 1.3333333333333  # 1 pt = 1/72 in\n",
        "    # Fallback: assume pixels\n",
        "    return numf\n",
        "\n",
        "\n",
        "def _dims(fig) -> Tuple[float, float]:\n",
        "    \"\"\"\n",
        "    Renvoie (width, height) de `fig` en pixels.\n",
        "\n",
        "    1) viewBox (les 2 derniers termes)\n",
        "    2) attributs width/height de la racine\n",
        "    3) fig.get_size()\n",
        "    \"\"\"\n",
        "    root = fig.root  # Correction ici : on accède à la balise <svg>\n",
        "    viewbox = root.get('viewBox')\n",
        "    if viewbox:\n",
        "        parts = [p for p in viewbox.replace(',', ' ').split() if p]\n",
        "        if len(parts) == 4:\n",
        "            return float(parts[2]), float(parts[3])\n",
        "\n",
        "    # attributs width/height sur la balise <svg>\n",
        "    w_attr = root.get('width')\n",
        "    h_attr = root.get('height')\n",
        "    if w_attr and h_attr:\n",
        "        return _to_px(w_attr), _to_px(h_attr)\n",
        "\n",
        "    # fallback\n",
        "    w, h = fig.get_size()\n",
        "    return _to_px(w), _to_px(h)\n",
        "\n",
        "\n",
        "def assemble(arome: Path, stations: Path, legend: Path, output: Path) -> None:\n",
        "    # Charger les 3 SVG\n",
        "    fig_arome = fromfile(str(arome))\n",
        "    fig_stations = fromfile(str(stations))\n",
        "    fig_legend = fromfile(str(legend))\n",
        "\n",
        "    # Dimensions\n",
        "    w_arome, h_arome = _dims(fig_arome)\n",
        "    w_stations, h_stations = _dims(fig_stations)\n",
        "    w_leg, h_leg = _dims(fig_legend)\n",
        "\n",
        "    # Canvas global\n",
        "    w_maps = max(w_arome, w_stations)\n",
        "    h_maps = h_arome + h_stations\n",
        "    height = h_maps  # somme des deux cartes\n",
        "\n",
        "    # Facteur d'échelle pour que la légende fasse 1.5 fois la hauteur de la carte AROME\n",
        "    scale_leg = (1.5 * h_arome) / h_leg\n",
        "    w_leg_scaled = w_leg * scale_leg\n",
        "    h_leg_scaled = h_leg * scale_leg  # = 1.5 * h_arome\n",
        "\n",
        "    width = w_maps + w_leg_scaled  # légende à droite\n",
        "\n",
        "    canvas = SVGFigure(f\"{width}px\", f\"{height}px\")\n",
        "    canvas.root.set('viewBox', f\"0 0 {width} {height}\")\n",
        "\n",
        "    # Racines\n",
        "    root_arome = fig_arome.getroot()\n",
        "    root_stations = fig_stations.getroot()\n",
        "    root_legend = fig_legend.getroot()\n",
        "\n",
        "    # Redimensionnement de la légende\n",
        "    root_legend.scale(scale_leg, scale_leg)\n",
        "\n",
        "    # Positionnement\n",
        "    root_stations.moveto(0, h_arome)\n",
        "    # Centrage vertical de la légende sur la hauteur totale\n",
        "    y_leg = (h_maps - h_leg_scaled) / 2\n",
        "    root_legend.moveto(w_maps, y_leg)\n",
        "\n",
        "    canvas.append([root_arome, root_stations, root_legend])\n",
        "\n",
        "    os.makedirs(os.path.dirname(str(output)), exist_ok=True)\n",
        "    canvas.save(str(output))\n",
        "    pdf_path = str(output)[:-4] + \".pdf\"\n",
        "    cairosvg.svg2pdf(url=str(output), write_to=pdf_path)\n",
        "    return str(output)\n",
        "\n",
        "import numpy as np\n",
        "import matplotlib.pyplot as plt\n",
        "import matplotlib.ticker as mticker\n",
        "\n",
        "def combined_metrics_df(name_file: str):\n",
        "    base_dir = Path(\"../outputs\")         # dossier racine à explorer\n",
        "    csv_paths = list(base_dir.rglob(name_file))\n",
        "\n",
        "    frames = []\n",
        "    for path in csv_paths:\n",
        "        try:\n",
        "            df = pd.read_csv(path)\n",
        "            df[\"source\"] = str(path.relative_to(base_dir))  # garder la provenance\n",
        "            frames.append(df)\n",
        "        except Exception as exc:                             # CSV illisible\n",
        "            print(f\"⚠️  Fichier ignoré {path}: {exc}\")\n",
        "\n",
        "    if not frames:\n",
        "        raise SystemExit(\"Aucun metrics.csv trouvé !\")\n",
        "\n",
        "    # Concaténation puis export\n",
        "    combined = pd.concat(frames, ignore_index=True)\n",
        "\n",
        "    # --- harmonisation des échelles ---\n",
        "    # cas quotidien_reduce\n",
        "    mask_q = combined[\"source\"].str.contains(\"quotidien_reduce\", na=False)\n",
        "    combined.loc[mask_q & (combined[\"echelle\"] == \"quotidien\"), \"echelle\"] = \"quotidien_reduce\"\n",
        "\n",
        "    # cas horaire_reduce\n",
        "    mask_h = combined[\"source\"].str.contains(\"horaire_reduce\", na=False)\n",
        "    combined.loc[mask_h & (combined[\"echelle\"] == \"horaire\"), \"echelle\"] = \"horaire_reduce\"\n",
        "\n",
        "    return combined\n",
        "\n",
        "combined = combined_metrics_df(\"metrics.csv\")\n",
        "combined_signif = combined_metrics_df(\"metrics_signif.csv\")\n",
        "combined_signif[\"col_calculate\"] = combined_signif[\"col_calculate\"].astype(str) + \"_signif\"\n",
        "combined_all = pd.concat([combined, combined_signif], ignore_index=True)\n",
        "\n",
        "\n",
        "import math\n",
        "import numpy as np\n",
        "import matplotlib.pyplot as plt\n",
        "import matplotlib.ticker as mticker\n",
        "\n",
        "\n",
        "def plot_r_by_season(\n",
        "    df,\n",
        "    echelles,\n",
        "    col_values,          # <-- plusieurs indicateurs (ex. ['numday', 'mean', 'mean-max'])\n",
        "    nom_fichier,         # préfixe du fichier (le numéro du facet est ajouté automatiquement)\n",
        "    col_plot: str=\"r\"\n",
        "):\n",
        "    \"\"\"\n",
        "    Trace un bar‑chart groupé « r » par saison, pour plusieurs indicateurs.\n",
        "    Produit un seul PNG contenant un facet‑grid (nrows × ncols).\n",
        "\n",
        "    Parameters\n",
        "    ----------\n",
        "    df : pandas.DataFrame\n",
        "    echelles : list[str]\n",
        "        Sous-ensemble d'échelles à garder (ex. ['quotidien', 'horaire'])\n",
        "    col_values : list[str]\n",
        "        Liste des valeurs cibles de la colonne 'col_calculate'\n",
        "    nom_fichier : str\n",
        "        Nom de base du fichier PNG (sans extension)\n",
        "    \"\"\"\n",
        "    ncols=len(col_values)\n",
        "\n",
        "    label_map = {\n",
        "        \"numday\":  \"Nombre de jour de pluie\",\n",
        "        \"mean\":    \"Cumul de précipitations\",\n",
        "        \"mean-max\": \"Moyenne des maxima\",\n",
        "        \"z_T_p\":   \"Tendance significative et non significative\",\n",
        "        \"z_T_p_signif\":   \"Tendance significative\"\n",
        "    }\n",
        "\n",
        "    # ---------------------------------------------\n",
        "    # 0) Préparation de la grille de sous‑graphes\n",
        "    # ---------------------------------------------\n",
        "    n_facets = len(col_values)\n",
        "    ncols = max(1, min(ncols, n_facets))\n",
        "    nrows = math.ceil(n_facets / ncols)\n",
        "\n",
        "    fig, axes = plt.subplots(\n",
        "        nrows=nrows,\n",
        "        ncols=ncols,\n",
        "        figsize=(12, 5 * nrows),\n",
        "        sharey=True\n",
        "    )\n",
        "    # axes → tableau 1D pour itération uniforme\n",
        "    axes = np.atleast_1d(axes).flatten()\n",
        "\n",
        "    # Pour récupérer une seule fois handles/labels de la légende\n",
        "    first_handles, first_labels = None, None\n",
        "\n",
        "    # ------------------------------------------------------------------\n",
        "    # Boucle sur chaque col_value demandé → un subplot par indicateur\n",
        "    # ------------------------------------------------------------------\n",
        "    for ax, col_value in zip(axes, col_values):\n",
        "        # --- 1) Filtrage identique ---\n",
        "        sub = df.loc[\n",
        "            (df[\"echelle\"].isin(echelles)) &\n",
        "            (df[\"col_calculate\"] == col_value),\n",
        "            [\"season\", \"echelle\", col_plot]\n",
        "        ]\n",
        "        if sub.empty:\n",
        "            ax.set_visible(False)\n",
        "            ax.set_title(f\"Aucune donnée pour '{col_value}'\")\n",
        "            continue\n",
        "\n",
        "        sub[\"season\"] = sub[\"season\"].str.upper()\n",
        "\n",
        "        # --- 2) Ordre fixe ---\n",
        "        ordre_total = [\n",
        "            \"HYDRO\", \n",
        "            \"SON\", \"DJF\", \"MAM\", \"JJA\",\n",
        "            \"OND\", \"JFM\", \"AMJ\", \"JAS\",\n",
        "            \"SEP\", \"OCT\", \"NOV\", \"DEC\", \"JAN\", \"FEV\", \n",
        "            \"MAR\", \"AVR\", \"MAI\", \"JUI\", \"JUILL\", \"AOU\"\n",
        "        ]\n",
        "        saisons_pres = [s for s in ordre_total if s in sub[\"season\"].unique()]\n",
        "\n",
        "        # --- 3) Renommage des échelles ---\n",
        "        rename_map = {\n",
        "            \"quotidien\":        \"Journalière (1959‑2022)\",\n",
        "            \"quotidien_reduce\": \"Journalière (1990‑2022)\",\n",
        "            \"horaire\":          \"Horaire (1990‑2022)\",\n",
        "        }\n",
        "\n",
        "        # --- 4) Pivot ---\n",
        "        pivot = (\n",
        "            sub.pivot(index=\"season\", columns=\"echelle\", values=col_plot)\n",
        "               .rename(columns=rename_map)\n",
        "               .reindex(saisons_pres)\n",
        "        )\n",
        "\n",
        "        # --- 5) Colonnes dans l’ordre demandé ---\n",
        "        ordre_cols = [\n",
        "            rename_map[k] for k in [\"quotidien\", \"quotidien_reduce\", \"horaire\"]\n",
        "            if rename_map[k] in pivot.columns\n",
        "        ]\n",
        "        pivot = pivot[ordre_cols]\n",
        "\n",
        "        # --- 6) Couleurs ---\n",
        "        couleurs = [\"black\", \"dimgray\", \"lightgray\"][:pivot.shape[1]]\n",
        "\n",
        "        # --- 7) Bar chart groupé ---\n",
        "        x = np.arange(len(pivot))\n",
        "        largeur = 0.8 / pivot.shape[1]\n",
        "\n",
        "        for i, (col, couleur) in enumerate(zip(pivot.columns, couleurs)):\n",
        "\n",
        "            bars = ax.bar(\n",
        "                x + i * largeur,\n",
        "                pivot[col],\n",
        "                width=largeur,\n",
        "                color=couleur,\n",
        "                label=col\n",
        "            )\n",
        "\n",
        "        # --- 8) Axes, grille, ticks ---\n",
        "        ax.set_xticks(\n",
        "            x + largeur * (pivot.shape[1] - 1) / 2,\n",
        "            pivot.index\n",
        "        )\n",
        "        ax.tick_params(axis='x', rotation=45)   # Rotation ici\n",
        "        ax.set_xlabel(\"\")\n",
        "        if col_plot==\"me\":\n",
        "          ax.set_ylabel(\"Δ (AROME - Stations) (mm/h)\")\n",
        "        else:\n",
        "          ax.set_ylabel(col_plot)\n",
        "        ax.set_title(label_map.get(col_value, col_value))   # titre lisible pour chaque subplot)\n",
        "\n",
        "        if col_plot==\"r\":\n",
        "          ax.set_ylim(top=1)   # <-- Forcer ymax à 1\n",
        "          ax.yaxis.set_major_locator(mticker.MultipleLocator(0.1))\n",
        "          ax.yaxis.set_minor_locator(mticker.MultipleLocator(0.02))\n",
        "        else:\n",
        "          ax.yaxis.set_major_locator(mticker.MultipleLocator(0.5))\n",
        "          ax.yaxis.set_minor_locator(mticker.MultipleLocator(0.25))\n",
        "\n",
        "        ax.grid(axis=\"y\", which=\"major\", linestyle=\"--\", alpha=0.8)\n",
        "        ax.grid(axis=\"y\", which=\"minor\", linestyle=\":\",  alpha=0.5)\n",
        "\n",
        "        # mémoriser les handles/labels la première fois\n",
        "        if first_handles is None:\n",
        "            first_handles, first_labels = ax.get_legend_handles_labels()\n",
        "\n",
        "        # supprimer la légende locale seulement si elle existe\n",
        "        leg = ax.get_legend()\n",
        "        if leg is not None:\n",
        "            leg.remove()\n",
        "\n",
        "\n",
        "    # ------------------------------------------------------------------\n",
        "    # 9) Légende globale (ligne en‑haut, centrée)\n",
        "    # ------------------------------------------------------------------\n",
        "    if first_handles:\n",
        "        fig.legend(\n",
        "            first_handles,\n",
        "            first_labels,\n",
        "            loc=\"lower center\",\n",
        "            ncol=len(first_labels),\n",
        "            bbox_to_anchor=(0.5, 1.02)\n",
        "        )\n",
        "\n",
        "    fig.tight_layout()\n",
        "    fig.subplots_adjust(top=0.90)  # laisser de l’espace pour la légende globale\n",
        "\n",
        "    # ------------------------------------------------------------------\n",
        "    # 10) Sauvegarde\n",
        "    # ------------------------------------------------------------------\n",
        "    fig.savefig(f\"figures/{nom_fichier}.png\", dpi=500, bbox_inches=\"tight\")\n",
        "    plt.close(fig)"
      ],
      "id": "8dcb04e9",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "## Introduction et contexte\n",
        "\n",
        "### L'effet du réchauffement climatique sur les précipitations\n",
        "\n",
        "Le changement climatique entraine un réchauffement de l’air à la surface de la planète, plus marqué sur les continents que sur les océans [@IPCC2021]. L'augmentation est de +1,1°C à l'échelle mondiale, +1,7°C à l'échelle de la France métropolitaine et +2°C à l'échelle des Alpes françaises par rapport à l’ère préindustrielle. Par ailleurs, la relation de Clausius-Clapeyron montre que l'air chaud peut contenir plus d'humidité (+7%/°C) [@clapeyron1834]. Autrement dit, à +1°C, une même masse d’air pourra contenir 7% de vapeur d’eau en plus. Du fait de la poussée d'Archimède, l'air chaud entourée d'air plus froid aura tendance à monter. L'ascension de l'air chaud dans l'atmosphère entraîne son refroidissement adiabatique, provoquant la condensation de la vapeur d'eau qui se transforme en précipitations [@meteofrance]. Toutefois, en conditions calmes, la partie centrale de la distribution des précipitations ne parvient pas à tirer pleinement parti de cet excédent d’humidité. Il existe des contraintes énergétiques (bilan radiatif, évaporation, échanges océan‑air) et dynamiques (subsidence, vent synoptique) qui limitent l’augmentation des précipitations moyennes à seulement 1–3%/°C [@IPCC2021]. En revanche, lors d’événements convectifs intenses (orage, cyclogenèse rapide) l’ascension rapide condense presque intégralement ce surplus, et les pluies maximales sur des durées courtes augmentent de 5 à 8% par °C, soit presque au même rythme que le potentiel théorique. Les extrêmes de précipitation suivent de près la loi de Clausius–Clapeyron, tandis que la pluie moyenne reste sous l’influence de nombreux autres facteurs énergétiques et dynamiques [@ogorman2015contrasting]. Ainsi, en réponse au réchauffement climatique il existe une augmentation *théorique* des précipitations extrêmes. Cette augmentation est néanmoins variable suivant les changements de circulations atmosphériques et peut être amplifiée localement [@blanchet2021explaining].\n",
        "\n",
        "### Les précipitations extrêmes\n",
        "\n",
        "Les précipitations extrêmes sont définies comme des épisodes de fortes pluies intenses sur de courtes durées (1h à 24h) et correspondent à la queue de la distribution des intensités pluviométriques. Il n'existe pas de définition consensuelle de ce qui caractérise un *extrême*. Certains auteurs étudient des précipitations d'intensités au-dessus du 99e percentile ou des maxima saisonniers/annuels. D'autres, considèrent les précipitations extrêmes comme des événements qui sont rarement ou jamais rencontrés dans la vie d'un humain (par exemple, des niveaux de précipitations aux quels on s'attend une fois tous les 10, 20 ou 50 ans). Les extrêmes sont au coeur des préoccupations climatiques et sociétales. Ces épisodent provoquent 90% des coûts liés aux inondations, aux glissements de terrain et aux ruptures d’infrastructures [@IPCC_2022_WGIII]. En 2024, de nombreux événements de ce type ont fait l'actualité, par exemple au Népal ou en Afghanistan et en Europe centrale avec l'Espagne orientale et la France [@WMO2025]. En particulier, en juin 2024, des pluies intenses en haute altitude qui ont contribué à des inondations majeures dans le massif des Écrins [@Blanc2024] ; en octobre 2024, plus de 600 mm en 48h dans le département de l'Ardèche [@MeteoFrance2024_episodesArdeches] ; en mai 2025, des orages courts mais extrêmement intenses (localement dépassant 120 mm/h) ont causé des dommages généralisés dans le sud du département du Var [@MeteoFrance2025].\n",
        "\n",
        "#### A l'échelle journalière\n",
        "\n",
        "Pour les extrêmes journaliers, le signal moyen à l’échelle globale est orienté à la hausse : la fréquence et l’intensité augmentent depuis les années 1950, avec des hausses significatives rapportées dans une majorité de régions et de mailles terrestres. Par exemple, le nombre annuel de jours dépassant 10 mm/j de précipitation a augmenté de +0,2 à +0,3 jour par décennie sur 1951–2010 [@Donat2013], avec seulement 29% des mailles terrestres présentant une hausse statistiquement significative. Les événements de type pluie extrême journalière avec retour décennal ont progressé d’environ +6,7 % dans 71 % des régions terrestres [@IPCC2021]. En France, les signaux sont beaucoup plus hétérogènes et souvent moins nets que pour la température, avec de fortes variations régionales. Dans la plupart des régions, les tendances restent faibles ou non significatives, et ce n’est que dans certaines zones, notamment le sud-est, que l’on détecte des signaux clairs. Dans cette région, la fréquence des épisodes méditerranéens extrêmes (cumuls > 200 mm en 24h) a doublé entre 1961 et 2020, même si la variabilité interannuelle reste très marquée [@meteofrance2024_episodesMediterraneens]. L’intensité moyenne des extrêmes journaliers y a augmenté de +22% entre 1961 et 2015 [@Ribes2019]. À l’échelle nationale, aucune tendance significative n’était détectable sur les maxima annuels de précipitations quotidiennes jusqu’aux années 1990. Depuis, certaines études rapportent des augmentations de +20 % à +40 %, mais ces estimations restent sensibles à la période et à la méthode d’analyse. Dans le sud-est des Alpes, la hausse du niveau de précipitation journalière attendue en moyenne tous les 20 ans en automne entre 1958 et 2017 pourrait atteindre un ordre de grandeur comparable à sa valeur moyenne (environ +100%) [@blanchet2021explaining]. Enfin, les projections montrent qu’un scénario de réchauffement de +4°C pourrait conduire à une hausse moyenne d’environ +15% des pluies extrêmes journalières en France et jusqu’à +20 % dans la moitié nord [@soubeyroux:hal-04991790]. Il existe une forte variabilité spatiale et interannuelle.\n",
        "\n",
        "#### A l'échelle horaire\n",
        "\n",
        "Les extrêmes horaires, mesurés sur des pas de temps de 1h ou moins, sont essentiels pour caractériser les phénomènes convectifs intenses (averses orageuses, orages stationnaires) souvent responsables de crues éclaires. Faute de séries longues et spatialisées, il n’existe pas d’analyse systématique des tendances sub‑journalières à l’échelle globale ; les données sont souvent éparses, courtes et non significatives. Malgré cela, plusieurs études régionales détectent une intensification des extrêmes horaires sur presque tous les continents, mais la confiance dans une hausse globale reste très faible [@IPCC2021]. Un accroissement des pluies extrêmes est relevée aux États-Unis, en Chine (l'été), en Australie (sur l'année), en Afrique du Sud (l'été), en Inde, en Malaisie, et en Italie. Plusieurs travaux mettent en évidence, selon la méthode et la région considérées, des sensibilités de l’ordre de +7% à +13% par °C, c’est‑à‑dire jusqu’à deux fois la pente de Clausius‑Clapeyron [@molnar2015relation]. En France, peu d'études régionales caractérisent explicitement cette hausse des extrêmes. Les valeurs maximales observées sur 1h atteignent maintenant 40–60 mm dans les événements méditerranéens majeurs, contre 30–40 mm dans les années 1980–1990 [@meteofrance2024_episodesMediterraneens]. Seul l'étude de @Berghald2025 semble chiffrer l'évolution des tendances des extrêmes horaires dans les Alpes. Cependant, la tendance sur le niveau de retour horaire est faible à non significative, sans cohérence spatiale ni saisonnière marquée, en contraste avec les résultats clairs observés au pas de temps journalier. Cela montre que les extrêmes horaires ne montrent pas (encore) de signal climatique clair [@Soubeyroux01022015].\n",
        "\n",
        "### Les données disponibles\n",
        "\n",
        "#### Relevés Météo-France\n",
        "\n",
        "Le réseau climatologique s'est développé à la fin du XIXᵉ siècle. Les lectures étaient manuelles, généralement une fois par jour (autour de 6h UTC, ce qui définit encore souvent le jour météorologique). Un réseau à l’échelle nationale est disponible à partir des années 1950–1960, période où la couverture devient suffisamment dense. Des centaines de séries précipitations existent aujourd’hui [@meteo-france_2020_breve_observation_classique]. A l'échelle horaire, les premières stations automatiques opérationnelles (SATIN) datent de 1967. La généralisation et la modernisation du réseau temps réel se fait surtout avec RADOME à partir de 1996, ce qui rend les cumuls horaires réellement disponibles et diffusés à grande échelle à partir des années 1990–2000. Aujourd’hui la mosaïque radar nationale fournit des données toutes les 5 min à 1 km, accessibles en archives publiques. Les lames d’eau ANTILOPE (radar + pluviomètres) sont produites opérationnellement, avec un pas de 15 min disponible depuis 2017.\n",
        "\n",
        "#### Apport des modèles climatiques\n",
        "\n",
        "La simulation des précipitations par modèle climatique apporte 1) des données antérieures aux données observées de 1990 ; et 2) des champs spatiaux complets et cohérents physiquement utile en zones peu instrumentées. Les modélisations GCM (General Circulation Model) ne se sont pas recommandées pour cette étude : la convection est paramétrée, les précipitations horaires sont souvent trop lissées et mal positionnées avec une résolution 12–200 km. L’émergence des modèles climatiques régionaux à convection explicite (CPMs, Convection-Permitting Model) ouvre une opportunité inédite : ils permettent de simuler, avec réalisme, la dynamique des précipitations intenses à fine échelle spatiale et temporelle sur de longues périodes. Pour cette étude le modèle doit être RCM (Regional Climate Model, 1–4 km) à convection explicite (CPM) pour représenter explicitement l’initiation, l’organisation et la propagation des systèmes convectifs et leurs extrêmes horaires. Les modèles répondant à ces critères sont : WRF 3 km, COSMO‑CLM 2.8 km, AROME‑Climate 2.5 km [@cnrm_arome2007], ICON-LEM 2.5 km, UKCP CPM 2.2 km, CP4‑Africa, ensembles EURO-CP / FPS‑Convection.\n",
        "\n",
        "#### Apport des réanalyses\n",
        "\n",
        "Un CP-RCM doit être initialisé (champs 3D de température, humidité, pression, vent, etc.) et forcé aux limites latérales. Historiquement, ces forçages utilisaient ERA-Interim (80 km / 6h / 1979-2019), désormais remplacé par ERA5 (25–31 km / 1h / 1949-présent), qui permet d’alimenter dynamiquement un modèle régional à maille fine. ERA5 étant une réanalyse, le modèle régional qu’elle force vise à reconstituer les conditions météorologiques passées heure par heure, et non à produire une simulation climatique prospective ou stochastique. Cette approche permet par exemple de caractériser les environnements convectifs [@ecmwf_era5_data_documentation], puis d'affiner avec un CPM pour simuler explicitement la convection. Le produit AROME (Application of Research to Operations at MEsoscale, 2,5 km / 1h) forcé par ERA5 sur la période 1959-2022 répond à ces critères et a été retenu comme modèle numérique pour cette étude ; à notre connaissance, il n’a encore jamais été évalué.\n",
        "\n",
        "### Intérêt de l’étude dans le paysage scientifique\n",
        "\n",
        "Si les tendances des extrêmes journaliers sont désormais bien documentées à l’échelle mondiale et régionale, les précipitations horaires — pourtant cruciales pour les inondations soudaines — souffrent encore d’un manque de documentation, notamment en France. Les observations longues et homogènes y sont rares, les tendances peu significatives, et les études ciblées encore peu nombreuses. Ce déficit de connaissance s'explique à la fois par la faible durée des séries horaires disponibles et par la complexité physique des processus convectifs à l’origine de ces extrêmes. La réanalyse AROME forcée par ERA5 (1959–2022) fournit un jeu de données unique pour étudier les précipitations horaires extrêmes en France. Toutefois, la validité des extrêmes simulés par ce modèle n'a jamais été évalué, tant du point de vue statistique que physique. Notre étude s’inscrit dans cette lacune. Elle vise à **évaluer finement la capacité du modèle AROME à reproduire les extrêmes horaires observés**, en mettant en regard les tendances modélisées et observées sur plusieurs décennies. Elle apporte ainsi une double contribution : 1) méthodologique, en évaluant de nouvelles simulations au regard d'observations d’extrêmes ; 2) climatique, en documentant pour la première fois les **évolutions temporelles** des extrêmes horaires en France sur 60 ans à partir d’un modèle à convection explicite validé. Ce travail éclaire ainsi la manière dont les extrêmes horaires évoluent dans un contexte de réchauffement climatique, tout en évaluant la pertinence des modèles climatiques CPM pour les études d’impact hydrométéorologique à l’échelle locale.\n",
        "\n",
        "## Méthodologie\n",
        "\n",
        "L'étude se concentre sur la France métropolitaine. Dans un premier temps, l’objectif est de valider le modèle (points de grille AROME) vis‑à‑vis des observations (stations Météo‑France) à l’aide d’indicateurs simples (corrélation et biais) mais représentatifs du régime de précipitations. Cette étape est conduite en contexte stationnaire, c’est‑à‑dire sans chercher encore à interpréter des tendances à long terme ou des ruptures de régime. Une fois cette validation stationnaire établie, l’analyse sera étendue à des contextes non stationnaires (tendances et variabilité des extrêmes).\n",
        "\n",
        "### Données utilisées\n",
        "\n",
        "#### Données observées\n",
        "\n",
        "Ce travail utilise les données de précipitations issues d'observations Météo-France [@meteofrance2024] au pas de temps journalier (1959-2022) et horaire (1990-2022) représentées sur la figure 1. Depuis les années 2000 des procédures d’homogénéisation (PRODIGE, puis HOMER) ont été mises en place dans la BDClim [@meteo-france_2020_breve_observation_classique].\n",
        "\n",
        "\\setlength{\\tabcolsep}{0pt}  \n",
        "\n",
        "| \\small Stations au pas de temps journalier (1959-2022) | \\small Stations au pas de temps horaire (1990-2022) |\n",
        "| :---: | :---: |\n",
        "| ![](../outputs/hist/dispo/quotidien/hydro/hist_len_years.pdf) | ![](../outputs/hist/dispo/horaire/hydro/hist_len_years.pdf) |\n",
        "| n = 8198 | n = 2315 |\n",
        "\n",
        "\n",
        "\\captionof{figure}{\\small Distribution du nombre d'années hydrologiques comportant au plus 10\\% de valeurs manquantes des stations Météo-France au pas de temps journalier (1959–2022) et horaire (1990–2022).}\n",
        "\n",
        "#### Données modélisées\n",
        "\n",
        "Le modèle numérique CP-RCM AROME, tout récemment forcé par réanalyse ERA5 offre, parmi différentes variables de sortie, des données de précipitations horaires de 1959 à 2022 à une résolution de 2,5 km sur le champ de calcul de la figure 2 [@arome2014]. En France métropolitaine 87 536 points sont générés. Dans le cadre d'un second stage auprès de Cécile Caillaud de Météo-France, Mathis Chevé a réalisé une étude conjointe sur la relation de Clausius-Clapeyron montrant que les tendances de températures du modèle sont deux fois plus faibles que les tendances observées. Il est donc à noter pour la suite que la part des tendances des extrêmes liée à Clausius-Clapeyron sera théoriquement deux fois plus faible que les tendances observées.\n",
        "\n",
        "\\\n",
        "\\begin{center}\n",
        "  \\centering \\includegraphics[width=0.5\\textwidth]{fig/espace_definition.pdf}\n",
        "\\end{center}\n",
        "\\\n",
        "\\captionof{figure}{\\small Cartographie du champ de calcul du modèle numérique AROME.}\n",
        "\n",
        "#### Filtrage des séries temporelles\n",
        "\n",
        "En chaque point géographique on calcule la part de données manquantes dans la série temporelle pour chaque saison (ou mois) et année. On élimine les années dont cette part dépasse le seuil fixé de 10%. On déduit le nombre d’années valides restantes. On ne garde que les points géographiques qui possèdent au moins le nombre minimal d’années exigé (50 ans pour la période 1959-2022 et 25 ans pour la période 1990-2022). Les analyses suivantes ne portent plus que sur ce sous‑ensemble de stations et d’années.\n",
        "\n",
        "### Définition des saisons\n",
        "\n",
        "Les saisons sont définies par **SON** pour septembre (**SEP**) octobre (**OCT**) novembre (**NOV**), **DJF** pour décembre (**DEC**) janvier (**JAN**) février (**FEV**), **MAM** pour mars (**MAR**) avril (**AVR**) mai (**MAI**), et **JJA** pour juin (**JUI**) juillet (**JUILL**) août (**AOU**). L'année hydrologique (**HYDRO**) est définie comme la période allant du 1er septembre de l'année N au 31 août de l'année N+1.\n",
        "\n",
        "### Calcul des indicateurs descriptifs\n",
        "\n",
        "À partir des données obtenues de Météo-France et d'AROME, le nombre de jour de pluie (seuil fixé à 1 mm/j), le cumul et les maxima de précipitations journalières et horaires ont été calculées pour chaque point de grille AROME ou station, année et mois/saison sur les période 1959-2022 et 1990-2022.\n",
        "\n",
        "### Vers une généralisation par modélisation statistique\n",
        "\n",
        "Les statistiques descriptives ne permettent pas d’extrapoler, quantifier l’incertitude et la significativité et de relier proprement les tendances observées aux mécanismes physiques. On ne peut donc pas transformer des constats descriptifs en résultats exploitables et comparables. Pour répondre à ces questions, nous mobilisons la théorie des valeurs extrêmes et en particulier le théorème de Fisher–Tippett–Gnedenko [@coles2001introduction]. Les maxima, une fois normalisés, convergent vers une famille généralisée des valeurs extrêmes (GEV - Generalized Extreme Value). C’est l’analogue, pour les maxima, du théorème central limite pour les sommes. Ce théorème stipule que, si $(M_n)$ désigne la suite des maxima normalisés d’échantillons indépendants et identiquement distribués, alors sous des conditions générales, la loi limite de $M_n$ appartient à la famille généralisée des valeurs extrêmes. La GEV unifie trois familles classiques : Gumbel ($\\xi \\to 0$), Fréchet ($\\xi > 0$) et Weibull ($\\xi < 0$). La *bonne* famille étant déterminée automatiquement par l’estimation de $\\xi$ qui contrôle la lourdeur de la queue. Nous ajustons des lois GEV aux maxima, d’abord dans un cadre stationnaire pour valider le bon comportement du modèle, puis dans un cadre non‑stationnaire où les paramètres de la GEV dépendent du temps. Cette étape nous permet de comparer de manière cohérente les niveaux de retour entre observations et AROME, d’estimer leurs tendances et de relier ces tendances aux mécanismes physiques.\n",
        "\n",
        "#### Définitions\n",
        "\n",
        "Si on note $x$ une réalisation de la variable aléatoire $X$, représentant le maximum annuel de précipitations en un point spatial donné, alors la loi GEV est une loi de probabilité continue paramétrée par le triplet $\\theta = (\\mu, \\sigma, \\xi)$ — respectivement la position, l’échelle (strictement positive) et la forme dont la fonction de répartition cumulative est :\n",
        "\n",
        "$$\n",
        "F(x;\\mu ,\\sigma ,\\xi) = \\exp\\left\\{-\\left[1 + \\xi\\frac{x - \\mu}{\\sigma}\\right]^{-1/\\xi}\\right\\}, \\quad 1 + \\xi\\frac{x - \\mu}{\\sigma} > 0\n",
        "$$\n",
        "\n",
        "#### Covariable temporelle\n",
        "\n",
        "On dispose d'une série temporelle de $n$ maxima annuels de précipitations pour un point géographique. On suppose ces maxima indépendants. Ces observations sont notées $\\{x_1, x_2, \\dots, x_n\\}$ où chaque $x_i$ est un maximum annuel de précipitations observé à l'année $t_i$ et qui suit une loi GEV dont les paramètres dépendent, analytiquement, de l'année $i$. On transforme l’année $t_i$ en une covariable normalisée notée $\\tilde{t}_i$. Cette transformation est simplement réalisée pour des raisons numériques mais elle ne change rien au résultat théorique. On crée également une covariable temporelle avec point de rupture noté $t_+$ tel que :\n",
        "\n",
        "$$\n",
        "\\tilde{t}_i = \\frac{t_i - t_{\\min}}{t_{\\max} - t_{\\min}} \\quad \\text{avec} \\quad \\begin{cases}\n",
        "t_{min} = \\min_i t_i \\\\\n",
        "t_{max} = \\max_i t_i\n",
        "\\end{cases} \\quad \\text{et} \\quad\n",
        "\\tilde{t}_{i}^\\ast =\n",
        "\\begin{cases}\n",
        "0 & \\text{si } t_i < t_+ \\\\\n",
        "\\displaystyle \\frac{t_i - t_+}{t_{\\max} - t_+} & \\text{si } t_i \\ge t_+\n",
        "\\end{cases}\n",
        "$$\n",
        "\n",
        "Ce codage permet d’appliquer une pente temporelle seulement après la date de rupture, avec une covariable encore normalisée sur $[0,1]$ dans la portion post-rupture.\n",
        "\n",
        "#### Modèles utilisés\n",
        "\n",
        ":::{.callout}\n",
        "Soit la covariable $t \\in \\mathbb{N} \\mid t_{\\min} \\leq t \\leq t_{\\max}$. Le modèle stationnaire est défini par $M_0(\\theta_0)$ et $\\theta_0 = (\\mu_0, \\sigma_0, \\xi_0)$ avec $\\mu(t) = \\mu_0$ ; $\\sigma(t) = \\sigma_0$ ; $\\xi(t) = \\xi_0$. Les modèles non stationnaires sont définis par :\n",
        "\n",
        "$$\n",
        "\\begin{array}{c@{\\qquad}c@{\\qquad}c}\n",
        "% -------- Colonne 1 --------\n",
        "\\begin{array}{c}\n",
        "\\begin{aligned}\n",
        "M_1(\\theta_1)\\\\[-0.2ex]\n",
        "\\theta_1 = (\\mu_0, \\mu_1, \\sigma_0, \\xi_0)\n",
        "\\end{aligned}\\\\[0.4ex]\n",
        "\\begin{cases}\n",
        "\\mu(t) = \\mu_0 + \\mu_1\\, t \\\\\n",
        "\\sigma(t) = \\sigma_0 \\\\\n",
        "\\xi(t) = \\xi_0\n",
        "\\end{cases}\n",
        "\\end{array}\n",
        "&\n",
        "% -------- Colonne 2 --------\n",
        "\\begin{array}{c}\n",
        "\\begin{aligned}\n",
        "M_2(\\theta_2)\\\\[-0.2ex]\n",
        "\\theta_2 = (\\mu_0, \\sigma_0, \\sigma_1, \\xi_0)\n",
        "\\end{aligned}\\\\[0.4ex]\n",
        "\\begin{cases}\n",
        "\\mu(t) = \\mu_0 \\\\\n",
        "\\sigma(t) = \\sigma_0 + \\sigma_1\\, t \\\\\n",
        "\\xi(t) = \\xi_0\n",
        "\\end{cases}\n",
        "\\end{array}\n",
        "&\n",
        "% -------- Colonne 3 --------\n",
        "\\begin{array}{c}\n",
        "\\begin{aligned}\n",
        "M_3(\\theta_3)\\\\[-0.2ex]\n",
        "\\theta_3 = (\\mu_0, \\mu_1, \\sigma_0, \\sigma_1, \\xi_0)\n",
        "\\end{aligned}\\\\[0.4ex]\n",
        "\\begin{cases}\n",
        "\\mu(t) = \\mu_0 + \\mu_1\\, t \\\\\n",
        "\\sigma(t) = \\sigma_0 + \\sigma_1\\, t \\\\\n",
        "\\xi(t) = \\xi_0\n",
        "\\end{cases}\n",
        "\\end{array}\n",
        "\\end{array}\n",
        "$$\n",
        "\n",
        ":::\n",
        "\n",
        "Lorsqu'un point de rupture noté $t_+$ est introduit, on note : \n",
        "\n",
        "$$\n",
        "t^\\ast = t \\cdot \\mathbb{1}_{t > t_+} \\quad \\text{avec} \\quad t_+ \\in \\mathbb{N}\n",
        "$$\n",
        "\n",
        "Les modèles $M_1$, $M_2$ et $M_3$ deviennent respectivements $M_1^\\ast$, $M_2^\\ast$ et $M_3^\\ast$. Sur cette même notation $\\theta_i$ devient $\\theta^\\ast_i$ avec $i \\in \\{1, 2, 3\\}$. Dans cette étude, on réalise les modélisations stationnaire et non-stationnaires avec pour covariable l'année et un effet temporel sur $\\mu$ ou $\\sigma$ ou $\\mu$ et $\\sigma$. $\\xi$ est choisi comme constant. Sur la base bibliographique, on choisi $t_+ = 1985$. Cette année de rupture est motivée par plusieurs considérations : 1) des études précédentes ont montré que les tendances statistiquement significatives des extrêmes de précipitations quotidiennes dans le sud de la France commencent dans les années 1980 [@Blanchet2018] ; 2) c'est en ce point que la log-vraisemblance est maximisée [@Blanchet2018]. En utilisant une année de rupture, nous sommes en mesure de minimiser les potentiels biais découlant des différentes longueurs d'observations tout en pouvant prendre en compte les données supplémentaires antérieures à 1985 pour rendre les estimations plus robustes.\n",
        "\n",
        "#### Niveau de retour\n",
        "\n",
        "Le niveau de retour (ou quantile d’ordre $1 - \\tfrac{1}{T}$) dans une loi GEV (Figure 3) correspond à une valeur seuil $z_T$ que l’on dépasse, en moyenne, une fois tous les $T$ ans. Soit $X \\sim \\mathrm{GEV}(\\mu, \\sigma, \\xi)$, alors en notant $F^{-1}$ la fonction quantile de la GEV, on obtient :\n",
        "\n",
        ":::{.callout}\n",
        "\n",
        "$$\n",
        "\\mathbb{P}(X > z_T) = \\frac{1}{T}, \\quad \\text{soit} \\quad z_T = F^{-1}\\left(1 - \\frac{1}{T} \\right) = \n",
        "\\begin{cases}\n",
        "\\mu + \\frac{\\sigma}{\\xi} \\left[ \\left( -\\log\\left(1 - \\frac{1}{T}\\right) \\right)^{-\\xi} - 1 \\right] & \\text{si } \\xi \\ne 0 \\\\\n",
        "\\mu - \\sigma \\log \\left( -\\log\\left(1 - \\frac{1}{T} \\right) \\right) & \\text{si } \\xi = 0 \\quad \\text{(Gumbel)}\n",
        "\\end{cases}\n",
        "$$\n",
        "\n",
        ":::\n",
        "\n",
        "<!-- @berghald2024caracterisation montre l'influence des paramètres de la GEV sur la densité de probabilité et sur la relation entre période et niveau de retour (Figure 3).\n",
        "\n",
        "\\\n",
        "\\begin{center}\n",
        "  \\includegraphics[width=0.6\\textwidth]{figures/fig_gev.png}\n",
        "\\end{center}\n",
        "\n",
        "\\captionof{figure}{\\small Influence des paramètres de la GEV sur la densité de probabilité (à gauche) et sur la relation entre période et niveau de retour (à droite) : position $\\mu$ (en haut), échelle $\\sigma$ (centre) et forme $\\xi$ (en bas). Les lignes pointillées montrent le niveau de retour de 20\\,ans pour les différents cas \\cite{berghald2024caracterisation}.} -->\n",
        "\n",
        "#### Vraisemblance et maximum de vraisemblance\n",
        "\n",
        "Soit la fonction de vraisemblance ${\\displaystyle {\\mathcal {L}}(\\theta ;x)} : {\\displaystyle \\theta \\mapsto f(x;\\theta )}$. La log-vraisemblance $\\ell(\\theta) = \\log \\mathcal{L}(\\theta)$ s’écrit après développement (Annexes 1-1) :\n",
        "\n",
        ":::{.callout}\n",
        "\n",
        "$$\n",
        "\\ell(\\theta)=\n",
        "-\\sum_{i=1}^n\\Bigl[\n",
        "\\log\\sigma\n",
        "+\\Bigl(1+\\tfrac1{\\xi}\\Bigr)\\log y_i\n",
        "+y_i^{-\\frac{1}{\\xi}}\n",
        "\\Bigr]\n",
        "\\quad \\text{avec} \\quad  y_i(\\theta)=1+\\xi\\;\\frac{x_i-\\mu}{\\sigma}\n",
        "\\tag{1}\n",
        "$$\n",
        "\n",
        ":::\n",
        "\n",
        "On obtient alors :\n",
        "\n",
        "$$\n",
        "\\scalebox{0.7}{\n",
        "\\(\n",
        "\\begin{aligned}\n",
        "\\ell_{M_0}(\\mu_0, \\sigma_0, \\xi_0) &=\n",
        "-\\sum_{i=1}^n \\left[\n",
        "\\log \\sigma_0 +\n",
        "\\left(1 + \\frac{1}{\\xi_0} \\right) \\log \\left(1 + \\xi_0 \\frac{x_i - \\mu_0}{\\sigma_0} \\right) +\n",
        "\\left(1 + \\xi_0 \\frac{x_i - \\mu_0}{\\sigma_0} \\right)^{-1/\\xi_0}\n",
        "\\right]\\\\ \n",
        "\\ell_{M_1}(\\mu_0, \\mu_1, \\sigma_0, \\xi_0) &=\n",
        "-\\sum_{i=1}^n \\left[\n",
        "\\log \\sigma_0 +\n",
        "\\left(1 + \\frac{1}{\\xi_0} \\right) \\log \\left(1 + \\xi_0 \\frac{x_i - (\\mu_0 + \\mu_1 \\cdot \\tilde{t}_i)}{\\sigma_0} \\right) +\n",
        "\\left(1 + \\xi_0 \\frac{x_i - (\\mu_0 + \\mu_1 \\cdot \\tilde{t}_i)}{\\sigma_0} \\right)^{-1/\\xi_0}\n",
        "\\right]\\\\ \n",
        "\\ell_{M_2}(\\mu_0, \\sigma_0, \\sigma_1, \\xi_0) &=\n",
        "-\\sum_{i=1}^n \\left[\n",
        "\\log (\\sigma_0 + \\sigma_1 \\tilde{t}_i) +\n",
        "\\left(1 + \\frac{1}{\\xi_0} \\right) \\log \\left(1 + \\xi_0 \\frac{x_i - \\mu_0}{\\sigma_0 + \\sigma_1 \\tilde{t}_i} \\right) +\n",
        "\\left(1 + \\xi_0 \\frac{x_i - \\mu_0}{\\sigma_0 + \\sigma_1 \\tilde{t}_i} \\right)^{-1/\\xi_0}\n",
        "\\right]\\\\ \n",
        "\\ell_{M_3}(\\mu_0, \\mu_1, \\sigma_0, \\sigma_1, \\xi_0) &=\n",
        "-\\sum_{i=1}^n \\left[\n",
        "\\log (\\sigma_0 + \\sigma_1 \\tilde{t}_i) +\n",
        "\\left(1 + \\frac{1}{\\xi_0} \\right) \\log \\left(1 + \\xi_0 \\frac{x_i - (\\mu_0 + \\mu_1 \\tilde{t}_i)}{\\sigma_0 + \\sigma_1 \\tilde{t}_i} \\right) +\n",
        "\\left(1 + \\xi_0 \\frac{x_i - (\\mu_0 + \\mu_1 \\tilde{t}_i)}{\\sigma_0 + \\sigma_1 \\tilde{t}_i} \\right)^{-1/\\xi_0}\n",
        "\\right]\n",
        "\\end{aligned}\n",
        "\\tag{1'}\n",
        "\\)\n",
        "}\n",
        "$$\n",
        "\n",
        "Les vraisemblances de $M_1^*, M_2^*, M_3^*$ sont obtenues en remplaçant $\\tilde{t}_i$ par $\\tilde{t}_i^\\ast$ dans les expressions ci-dessus.\n",
        "\n",
        "En pratique, les paramètres $(\\mu, \\sigma, \\xi)$ sont inconnus et estimés à partir des données par un estimateur $\\hat{\\theta} = (\\hat{\\mu}, \\hat{\\sigma}, \\hat{\\xi})$ obtenu par maximum de vraisemblance (MLE) via une optimisation numérique tel que $\\hat{\\theta} = \\arg\\max_{\\theta} \\, \\ell(\\theta)$. Il n’existe pas de formule explicite des paramètres, ceux-ci étant déterminés numériquement en maximisant la vraisemblance.\n",
        "\n",
        "L’estimateur du niveau de retour $\\hat{z}_T$ s’écrit alors $\\hat{z}_{T}\\;=\\;F^{-1}_{\\hat{\\theta}}\\!\\left(1-\\frac{1}{T}\\right)$. Le MLE classique donne un point estimé, mais pas d’intervalle. On souhaite aussi connaître l’incertitude autour de l'estimation de $\\hat{z}_T$. Pour cela, on utilise la vraisemblance profilée.\n",
        "\n",
        "#### Vraisemblance profilée et intervalle de confiance d'un niveau de retour\n",
        "\n",
        "$z_T$ peut se réecrire sous la forme $\\mu = z_T - \\dfrac{\\sigma}{\\xi} \\left[ \\left( -\\log\\left(1 - \\frac{1}{T} \\right) \\right)^{-\\xi} - 1 \\right]$.\n",
        "La combinaison des paramètres temporels de la loi GEV conduit à une expression linéaire en $t$ : \n",
        "\n",
        "$$\n",
        "z_T(t) = z_{T,0} + z_{T,1} \\cdot t\n",
        "$$\n",
        "\n",
        "En développant les paramètres soumis à un effet temporel et on regroupant terme à terme on peut montrer que (Annexes 1-2) :\n",
        "\n",
        "$$\n",
        "\\mu_1(z_{T,1}) = z_{T,1} -\\dfrac{\\hat{\\sigma_1}}{\\hat{\\xi}_0}\\Bigl(\\bigl[-\\log(1-\\tfrac1T)\\bigr]^{-\\hat{\\xi}_0}-1\\Bigr) \\quad \\text{et} \\quad\n",
        "\\sigma_1(z_{T,1}) = \\dfrac{\\hat{\\xi}_0\\,\\bigl(z_{T,1}-\\hat{\\mu_1}\\bigr)}{\\bigl[-\\log\\!\\bigl(1-\\tfrac1T\\bigr)\\bigr]^{-\\hat{\\xi}_0}-1}\n",
        "$$\n",
        "\n",
        "On cherche l'intervalle de confiance sur $z_{T,1}$ donc pour chaque valeur candidate $z_{T,1}$ dans une grille (autour de l’estimateur $\\hat{z}_{T,1}$), on maximise les log-vraisemblances (1') qui deviennent des log-vraisemblances profilées $\\ell^{\\,p}$ :\n",
        "\n",
        "$$\n",
        "\\scalebox{0.7}{\n",
        "\\(\n",
        "\\begin{aligned}\n",
        "\\underset{\\hat{\\sigma}_1 = 0}{\\ell_{M_1}^{\\,p}(z_{T,1} \\ ; \\hat{\\mu}_0, \\hat{\\sigma}_0, \\hat{\\xi}_0)} &= \n",
        "-\\sum_{i=1}^n \\left[\n",
        "\\log \\hat{\\sigma}_0 +\n",
        "\\left(1 + \\frac{1}{\\hat{\\xi}_0} \\right) \\log \\left(1 + \\hat{\\xi}_0 \\frac{x_i - (\\hat{\\mu}_0 + \\mu_1(z_{T,1}) \\cdot \\tilde{t}_i)}{\\hat{\\sigma}_0} \\right) +\n",
        "\\left(1 + \\hat{\\xi}_0 \\frac{x_i - (\\hat{\\mu}_0 + \\mu_1(z_{T,1}) \\cdot \\tilde{t}_i)}{\\hat{\\sigma}_0} \\right)^{-1/\\hat{\\xi}_0}\n",
        "\\right]\\\\\n",
        "\\underset{\\hat{\\mu}_1 = 0}{\\ell_{M_2}^{\\,p}(z_{T,1} \\ ; \\hat{\\mu}_0, \\hat{\\sigma}_0, \\hat{\\xi}_0)} &= \n",
        "-\\sum_{i=1}^n \\left[\n",
        "\\log (\\hat{\\sigma}_0 + \\sigma_1(z_{T,1}) \\cdot \\tilde{t}_i) +\n",
        "\\left(1 + \\frac{1}{\\hat{\\xi}_0} \\right) \\log \\left(1 + \\hat{\\xi}_0 \\frac{x_i - \\hat{\\mu}_0}{\\hat{\\sigma}_0 + \\sigma_1(z_{T,1}) \\cdot \\tilde{t}_i} \\right) +\n",
        "\\left(1 + \\hat{\\xi}_0 \\frac{x_i - \\hat{\\mu}_0}{\\hat{\\sigma}_0 + \\sigma_1(z_{T,1}) \\cdot \\tilde{t}_i} \\right)^{-1/\\hat{\\xi}_0}\n",
        "\\right]\\\\\n",
        "\\ell_{M_3}^{\\,p}(z_{T,1} \\ ; \\hat{\\mu}_0, \\hat{\\sigma}_0, \\hat{\\sigma}_1, \\hat{\\xi}_0) &= \n",
        "-\\sum_{i=1}^n \\left[\n",
        "\\log (\\hat{\\sigma}_0 + \\hat{\\sigma}_1 \\tilde{t}_i) +\n",
        "\\left(1 + \\frac{1}{\\hat{\\xi}_0} \\right) \\log \\left(1 + \\hat{\\xi}_0 \\frac{x_i - (\\hat{\\mu}_0 + \\mu_1(z_{T,1}) \\tilde{t}_i)}{\\hat{\\sigma}_0 + \\hat{\\sigma}_1 \\tilde{t}_i} \\right) +\n",
        "\\left(1 + \\hat{\\xi}_0 \\frac{x_i - (\\hat{\\mu}_0 + \\mu_1(z_{T,1}) \\tilde{t}_i)}{\\hat{\\sigma}_0 + \\hat{\\sigma}_1 \\tilde{t}_i} \\right)^{-1/\\hat{\\xi}_0}\n",
        "\\right]\\\\\n",
        "\\end{aligned}\n",
        "\\tag{2}\n",
        "\\)\n",
        "}\n",
        "$$\n",
        "\n",
        "On cherche donc :\n",
        "\n",
        "$$\n",
        "\\hat{z}_{T,1} = \\underset{z_{T,1}}{\\arg\\max} \\; \\ell_{M_\\bullet}^{\\,p}(z_{T,1} \\ ; \\hat{\\theta}_{\\bullet}) \\quad \\text{avec} \\quad\n",
        "\\hat{\\theta}_{\\bullet} = \\begin{cases}\n",
        "\\hat{\\theta}_{1}^{\\,p} = (\\hat{\\mu_0}, \\hat{\\sigma_0}, \\hat{\\xi_0}) & \\text{pour } M_1 \\\\\n",
        "\\hat{\\theta}_2^{\\,p} = (\\hat{\\mu_0}, \\hat{\\sigma_0}, \\hat{\\xi_0}) & \\text{pour } M_2 \\\\\n",
        "\\hat{\\theta}_3^{\\,p} = (\\hat{\\mu_0}, \\hat{\\sigma_0}, \\hat{\\sigma_1}, \\hat{\\xi_0}) & \\text{pour } M_3 \\\\\n",
        "\\end{cases}\n",
        "$$\n",
        "\n",
        "On trace ainsi pour chaque modèle $M_\\bullet$ la fonction ${\\displaystyle \\mathcal{L}_{M_\\bullet} : z_{T,1} {\\mapsto} \\ell_{M_\\bullet}^{\\,p}(z_{T,1} \\ ; \\hat{\\theta}_{\\bullet})}$\n",
        "\n",
        "L’intervalle de confiance de $\\hat{z}_{T,1}$ pour un modèle $M_\\bullet$ au seuil $(1 - \\alpha)$ basé sur le profil de vraisemblance est donné par :\n",
        "\n",
        "$$\n",
        "\\operatorname{IC}_{M_\\bullet}^{(1-\\alpha)}\\!\\bigl(\\hat{z}_{T,1}\\bigr)\n",
        "   = \\Bigl\\{\\, z_{T,1}\\;:\\;\n",
        "        2\\bigl[\\ell_{M_\\bullet}^{\\,p}(\\hat{z}_{T,1} \\ ; \\hat{\\theta}_{\\bullet})-\\ell_{M_\\bullet}^{\\,p}(z_{T,1} \\ ; \\hat{\\theta}_{\\bullet})\\bigr]\n",
        "        \\le \\chi^{2}_{1,\\,1-\\alpha} \\Bigr\\}\n",
        "$$\n",
        "\n",
        "où $\\chi^2_{1,1-\\alpha}$ est le quantile d’ordre $1 - \\alpha$ d’une loi du $\\chi^2$ à un degré de liberté. On fixe ici $\\alpha=0{,}10$. Lorsque l'intervalle de confiance ne contient pas 0 alors $\\hat{z}_{T,1}$ est significatif.\n",
        "\n",
        "### Choix du meilleur modèle\n",
        "\n",
        "#### Test du rapport de vraisemblance (LRT)\n",
        "\n",
        "En tout point géographique on dispose de $M_0, M_1, M_2, M_3, M_1^\\ast, M_2^\\ast \\text{ et } M_3^\\ast$. Notons $k_j$ le nombre de paramètres du modèle $M_j$. On souhaite tester, pour chaque modèle non stationnaire $j \\neq 0$, l’hypothèse nulle $H_0$ : $M_j$ ne fait pas mieux que $M_0$ (stationnarité). Pour chaque modèle non stationnaire $j\\neq 0$ et chaque point $i$ en notant $p_{ij}$ la $p$-valeur :\n",
        "\n",
        "$$\n",
        "\\Lambda_{ij}=2\\bigl(\\ell_{ij}-\\ell_{i0}\\bigr) \\overset{H_0}{\\sim}\\chi^{2}_{\\;k_j-k_0} \\quad \\text{avec} \\quad p_{ij}= \\mathbb{P}(\\chi^{2}_{k_j-k_0}\\ge \\Lambda_{ij}\\bigr)\n",
        "$$\n",
        "\n",
        "#### Règle hiérarchique de sélection\n",
        "\n",
        "Soit $\\alpha=0{,}10$ le seuil d’intérêt. Si un des deux modèles $M_3$ ou $M_3^\\ast$ vérifie $p_{ij}\\le\\alpha$, on retient $j=\\arg\\min_{j\\in\\{3,3^\\ast\\}} p_{ij}$. Sinon, on compare l’ensemble des six modèles non stationnaires et l’on sélectionne $j=\\arg\\min_{j\\in\\{1,1^\\ast,2,2^\\ast,3,3^\\ast\\}} p_{ij}$. Cette double étape privilégie les formes *simultanément* temporelles sur $\\mu$ et $\\sigma$ quand elles sont statistiquement justifiées. Cela assure que la complexité n’est introduite que lorsqu’elle apporte une information statistiquement crédible tout en livrant, pour chaque poste, un modèle non stationnaire.\n",
        "\n",
        "### Calcul des tendances\n",
        "\n",
        "A partir des niveaux de retour 10 ans ($T = 10$) la tendance relative (en %) entre 1995 et 2022 est calculée via la formule ci-dessous. Un exemple graphique est disponible en annexes 2-6.\n",
        "\n",
        ":::{.callout}\n",
        "\n",
        "$$\n",
        "\\text{Tendance} = \\frac{z_T^{2022} - z_T^{1995}}{z_T^{1995}} \\cdot {100}\n",
        "$$\n",
        "\n",
        ":::\n",
        "\n",
        "### Concordance\n",
        "\n",
        "On évalue l'accord entre les statistiques descriptives et les tendances obtenues à partir des simulations du modèle AROME et celles observées dans la réalité. Pour ce faire, chaque station Météo-France est associée au point de grille AROME (2,5 km × 2,5 km) correspondant à sa localisation géographique. Cette correspondance permet de calculer la corrélation de Pearson (*r*) ainsi que l'erreur moyenne (*ME*) entre les valeurs observées et simulées.\n",
        "\n",
        "### Représentation cartographique\n",
        "\n",
        "Pour homogénéiser les amplitudes extrêmes entre jeux de données (AROME et données observées), on applique une saturation de couleur suivant la période étudiée. Soit une période $P \\in \\{\\text{HYDRO}, \\text{DJF},\\text{MAM},\\text{JJA},\\text{SON}\\}$ ou $P \\in \\{\\text{JAN},\\text{FEV},\\text{MAR},\\text{...},\\text{OCT},\\text{NOV},\\text{DEC}\\}$. Pour chaque statistique (nombre de jour de pluie, cumul, moyenne des maxima, tendance relative) $T_j$ avec $j \\in P$, on calcule le *q*-ième percentile des valeurs absolues :\n",
        "\n",
        "$$\n",
        "s_j(P)=\\operatorname{Quantile}_{q}\\big(|T_j|\\big)\n",
        "$$\n",
        "\n",
        "Le seuil commun de la période $P$ est défini par $S(P)=\\max_j s_j(P)$. On remplace ensuite, pour toute valeur $x\\in T_j$, $x \\;\\leftarrow\\; \\operatorname{sign}(x)\\,\\min\\big(|x|,\\,S(P)\\big)$.\n",
        "\n",
        "On fixe $q$ de la manière suivante :\n",
        "\n",
        "- Pour le nombre de jour de pluie : $q = 99,9$ pour l'échelle journalière 1959-2022, 1990-2022 et l'échelle horaire 1990-2022.\n",
        "- Le cumul et la moyenne des maxima de précipitations : $q = 99,0$ pour l'échelle journalière 1959-2022, 1990-2022 et l'échelle horaire 1990-2022.\n",
        "- La tendance relative : $q = 99,0$ pour l'échelle journalière 1959-2022 et 1990-2022 et $q = 90,0$ pour l'échelle horaire 1990-2022.\n",
        "\n",
        "Les courbes de niveaux 400 et 800m sont représentées en trait fin.\n",
        "\n",
        "\n",
        "## Résultats\n",
        "\n",
        "Nous commençons par évaluer, point de grille par point de grille, la capacité d’AROME à reproduire le régime de précipitations observé par les stations Météo‑France. Cette première étape stationnaire sert d'évaluation de qualité avant d'étudier les tendances des niveaux de retour.\n",
        "\n",
        "### Évaluation de la climatologie des précipitations simulées par AROME\n",
        "\n",
        "Afin d’apprécier la capacité d’AROME à restituer la climatologie des précipitations, différents indicateurs sont confrontées aux observations de stations pour une saison donnée : 1) le nombre de jours de pluie (seuil ≥ 1 mm/j) ; 2) le cumul des précipitations ; et 3) la moyenne des maxima des précipitations."
      ],
      "id": "bb44f13d"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "jour_pluie = assemble(\n",
        "  \"../outputs/maps/stats_numday/quotidien/compare_1/sat_99.9/hydro/mod_norast.svg\",\n",
        "  \"../outputs/maps/stats_numday/quotidien/compare_1/sat_99.9/hydro/obs_norast.svg\",\n",
        "  \"../outputs/maps/stats_numday/quotidien/compare_1/sat_99.9/legend.svg\",\n",
        "  \"figures/jour_pluie.svg\"\n",
        ")\n",
        "df_jour_pluie = combined.loc[(combined[\"echelle\"] == \"quotidien\") & (combined[\"season\"] == \"hydro\") & (combined[\"col_calculate\"] == \"numday\"), [\"n\", \"r\", \"me\", \"delta\"]]\n",
        "\n",
        "mean_pluie_jour = assemble(\n",
        "  \"../outputs/maps/stats_mean/quotidien/compare_1/sat_99.0/hydro/mod_norast.svg\",\n",
        "  \"../outputs/maps/stats_mean/quotidien/compare_1/sat_99.0/hydro/obs_norast.svg\",\n",
        "  \"../outputs/maps/stats_mean/quotidien/compare_1/sat_99.0/legend.svg\",\n",
        "  \"figures/mean_pluie_jour.svg\"\n",
        ")\n",
        "df_mean_pluie_jour = combined.loc[(combined[\"echelle\"] == \"quotidien\") & (combined[\"season\"] == \"hydro\") & (combined[\"col_calculate\"] == \"mean\"), [\"n\", \"r\", \"me\", \"delta\"]]\n",
        "\n",
        "\n",
        "mean_max_pluie_jour = assemble(\n",
        "  \"../outputs/maps/stats_mean-max/quotidien/compare_9/sat_99.0/hydro/mod_norast.svg\",\n",
        "  \"../outputs/maps/stats_mean-max/quotidien/compare_9/sat_99.0/hydro/obs_norast.svg\",\n",
        "  \"../outputs/maps/stats_mean-max/quotidien/compare_9/sat_99.0/legend.svg\",\n",
        "  \"figures/mean-max_pluie_jour.svg\"\n",
        ")\n",
        "df_mean_max_pluie_jour = combined.loc[(combined[\"echelle\"] == \"quotidien\") & (combined[\"season\"] == \"hydro\") & (combined[\"col_calculate\"] == \"mean-max\"), [\"n\", \"r\", \"me\", \"delta\"]]\n",
        "\n",
        "mean_max_pluie_horaire = assemble(\n",
        "  \"../outputs/maps/stats_mean-max/horaire/compare_9/sat_99.0/hydro/mod_norast.svg\",\n",
        "  \"../outputs/maps/stats_mean-max/horaire/compare_9/sat_99.0/hydro/obs_norast.svg\",\n",
        "  \"../outputs/maps/stats_mean-max/horaire/compare_9/sat_99.0/legend.svg\",\n",
        "  \"figures/mean-max_pluie_horaire.svg\"\n",
        ")\n",
        "\n",
        "df_mean_max_pluie_horaire = combined.loc[(combined[\"echelle\"] == \"horaire\") & (combined[\"season\"] == \"hydro\") & (combined[\"col_calculate\"] == \"mean-max\"), [\"n\", \"r\", \"me\", \"delta\"]]\n",
        "\n",
        "df_mean_max_pluie_horaire_jja = combined.loc[(combined[\"echelle\"] == \"horaire\") & (combined[\"season\"] == \"jja\") & (combined[\"col_calculate\"] == \"mean-max\"), [\"n\", \"r\", \"me\", \"delta\"]]"
      ],
      "id": "f0236d9e",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "#### Distribution spatiale\n",
        "\n",
        "La distribution spatiale des indicateurs d'AROME au regard des observations permet de : 1) valider et diagnostiquer le modèle en localisant les biais et vérifier la structure spatiale (gradients et effets orographiques) ; et 2) comprendre les processus physique (distinguer les régimes (méditerranéen, alpin, plaine) et voir où AROME surestime l’orographique ou sous-estime les convectifs intenses).\n",
        "\n",
        "##### Nombre de jours de précipitations\n",
        "\n",
        "Sur la période 1959-2022 (Figure 4, colonne de gauche), AROME surestime légèrement la fréquence annuelle des jours de précipitation : `{python} f'{df_jour_pluie['me'].iloc[0].item():+.2f}'` jours/an (soit `{python} f'{df_jour_pluie['delta'].iloc[0].item():+.2f}'`%). Des biais locaux marqués subsistent toutefois : plus de +30 jours pour plusieurs stations du Massif central et des Pyrénées, tandis que des biais négatifs (−10 à −30 jours) se concentrent dans les Alpes du Nord, le Finistère et l’Alsace. La corrélation spatiale est élevée (*r =* `{python} f'{df_jour_pluie['r'].iloc[0].item():.2f}'`), indiquant que le modèle reproduit correctement les grands gradients régionaux. AROME et les observations s’accordent pour situer les fréquences maximales sur les massifs montagneux (Alpes, Pyrénées, Massif central, Vosges, Jura), avec plus de 140–160 jours/an, et des valeurs également élevées sur le Grand Ouest atlantique (Bretagne, Normandie, Pays de la Loire : 80–120 jours/an). À l’inverse, la façade méditerranéenne et le pourtour provençal restent les plus secs en fréquence, souvent < 50–70 jours/an.\n",
        "\n",
        "##### Cumul annuel des précipitations\n",
        "\n",
        "Sur la période 1959-2022 (Figure 4, colonne du centre), AROME estime correctement le cumul annuel des précipitations : `{python} f'{df_mean_pluie_jour['me'].iloc[0].item():+.2f}'` mm/an (soit `{python} f'{df_mean_pluie_jour['delta'].iloc[0].item():+.2f}'`%). Des biais locaux marqués subsistent toutefois : plus de +1,0 mm/j pour l'ensemble des stations de la crête pyrénéenne et de la station de Chamonix, tandis que des biais négatifs (−0,5 à −1,5 mm/j) se concentrent dans les Alpes du Nord, la côte basque et l’Alsace. La corrélation spatiale est élevée (*r =* `{python} f'{df_mean_pluie_jour['r'].iloc[0].item():.2f}'`), indiquant que le modèle reproduit correctement les grands gradients régionaux. La bordure atlantique sud‑ouest (Pyrénées, Aquitaine) et les Alpes du Nord reçoivent les plus forts cumuls (plus de 5 mm/j). Le Massif central et les reliefs intérieurs (Vosges, Jura) présentent des cumuls intermédiaires (2,5-4 mm/j). Le pourtour méditerranéen (Languedoc, Provence) reste globalement plus sec (< 1,5 mm/j), malgré des pluies intenses ponctuelles. Ces résultats sont identiques avec les données horaires de 1990 à 2022 (Annexe 2-2.3).\n",
        "\n",
        "\n",
        "\\setlength{\\tabcolsep}{0pt}  \n",
        "\n",
        "| \\shortstack{\\small Nombre de jours\\\\ par an\\\\ de précipitations} | \\shortstack{\\small Cumul\\\\ annuel\\\\ des précipitations} | \\shortstack{\\small Moyenne des maxima\\\\ journaliers\\\\ des précipitations} | \\shortstack{\\small Moyenne des maxima\\\\ horaires\\\\ des précipitations} |\n",
        "|:---:|:---:|:---:|:---:|\n",
        "| ![](figures/jour_pluie.pdf) | ![](figures/mean_pluie_jour.pdf) | ![](figures/mean-max_pluie_jour.pdf) | ![](figures/mean-max_pluie_horaire.pdf) |\n",
        "| \\small $r =$ `{python} f'{df_jour_pluie['r'].iloc[0].item():.2f}'` (n = `{python} f'{df_jour_pluie['n'].iloc[0].item()}'`) | \\small $r =$ `{python} f'{df_mean_pluie_jour['r'].iloc[0].item():.2f}'` (n = `{python} f'{df_mean_pluie_jour['n'].iloc[0].item()}'`) | \\small $r =$ `{python} f'{df_mean_max_pluie_jour['r'].iloc[0].item():.2f}'` (n = `{python} f'{df_mean_max_pluie_jour['n'].iloc[0].item()}'`) | \\small $r =$ `{python} f'{df_mean_max_pluie_horaire['r'].iloc[0].item():.2f}'` (n = `{python} f'{df_mean_max_pluie_horaire['n'].iloc[0].item()}'`) |\n",
        "| ![](../outputs/maps/stats_numday/quotidien/compare_1/sat_99.9/hydro/obs_rast_diff.pdf) | ![](../outputs/maps/stats_mean/quotidien/compare_1/sat_99.0/hydro/obs_rast_diff.pdf) | ![](../outputs/maps/stats_mean-max/quotidien/compare_9/sat_99.0/hydro/obs_rast_diff.pdf) | ![](../outputs/maps/stats_mean-max/horaire/compare_9/sat_99.0/hydro/obs_rast_diff.pdf) |\n",
        "| \\small $ME =$ `{python} f'{df_jour_pluie['me'].iloc[0].item():+.2f}'` j \\ (`{python} f'{df_jour_pluie['delta'].iloc[0].item():+.2f}'`%) | \\small $ME =$ `{python} f'{df_mean_pluie_jour['me'].iloc[0].item():+.2f}'` mm/an (`{python} f'{df_mean_pluie_jour['delta'].iloc[0].item():+.2f}'`%) | \\small $ME =$ `{python} f'{df_mean_max_pluie_jour['me'].iloc[0].item():+.2f}'` mm/j (`{python} f'{df_mean_max_pluie_jour['delta'].iloc[0].item():+.2f}'`%) | \\small $ME =$ `{python} f'{df_mean_max_pluie_horaire['me'].iloc[0].item():+.2f}'` mm/j (`{python} f'{df_mean_max_pluie_horaire['delta'].iloc[0].item():+.2f}'`%) |\n",
        "\n",
        "\n",
        "\\captionof{figure}{\\small Climatologie entre le modèle AROME (première ligne), les stations Météo-France (deuxième ligne) avec la corrélation ($r$) et le nombre de stations comparés (n) ainsi que la différence AROME-Station (troisième ligne) avec le biais ($ME$) et l'écart relatif (\\%) associé issues de données journalières allant de 1959 à 2022 pour une année hydrologique.}\n",
        "\n",
        "\n",
        "##### Moyenne des maxima des précipitations\n",
        "\n",
        "Sur la période 1959-2022 (Figure 4, colonne de droite), AROME sous-estime légèrement la moyenne des maxima journaliers des précipitations : `{python} f'{df_mean_max_pluie_jour['me'].iloc[0].item():+.2f}'` mm/j (soit `{python} f'{df_mean_max_pluie_jour['delta'].iloc[0].item():+.2f}'`%). Il subsiste d'importants biais locaux : déficits de −5 à moins de −20 mm/j sur l'ensemble des Cévennes et se prolongeant vers l'extrimité Nord des Alpes du Nord, sur la côté sud-est et la côte basque ; jusqu'à -5 mm/j sur une large partie du centre de la France et de l'Alsace ; de +5 à +20 mm/j sur la crête pyrénéennes, les contreforts ouest des Cévennes et les Alpes du Nord. La corrélation spatiale est élevée (*r =* `{python} f'{df_mean_max_pluie_jour['r'].iloc[0].item():.2f}'`), indiquant que le modèle reproduit correctement les grands gradients régionaux. Les plus fortes précipitations quotidiennes moyennes se rencontrent dans les Cévennes et plus généralement sur la face sud-est du Massif central (environ 100–125 mm/j). Les reliefs alpins et pyrénéens montrent aussi des maxima élevés (80–100 mm/j). La façade atlantique et le bassin parisien présentent des maxima plus modérés (30–60 mm/j), tandis que la Provence et la Côte d’Azur, malgré une fréquence moindre, peuvent localement connaître de très gros orages (40–80 mm/j en moyenne).\n",
        "\n",
        "\\\n",
        "\n",
        "Ces premiers résultats, marqués par des biais locaux importants sur les maxima journaliers, nous conduisent à descendre au pas de temps horaire (Figure 4). Sur la période 1990-2022, AROME sous-estime fortement la moyenne des maxima horaires des précipitations : `{python} f'{df_mean_max_pluie_horaire['me'].iloc[0].item():+.2f}'` mm/h (soit `{python} f'{df_mean_max_pluie_horaire['delta'].iloc[0].item():+.2f}'`%). Il subsiste d'importants biais : déficits de −5 à moins de −10 mm/h sur presque l'ensemble de la France mais surtout dans les Cévennes et la vallée du Rhône. La corrélation spatiale reste élevée (*r =* `{python} f'{df_mean_max_pluie_horaire['r'].iloc[0].item():.2f}'`), attestant d’une bonne restitution des grands gradients déjà observés au pas journalier. Au regard des saisons (Annexes 2-3.3), le biais s'étend de -0,02 mm/h (DJF) à -3,75 mm/h (JJA), suggérant une sous‑représentation marquée des extrêmes convectifs estivaux.\n",
        "\n",
        "#### Corrélation entre le modèle AROME et les stations Météo-France\n",
        "\n",
        "Quel que soit l'indicateur (Figure 6), le modèle AROME reproduit fidèlement les observations, avec une corrélation minimale de 0,70.\n",
        "Indépendamment de l’échelle temporelle retenue — journalière (1959‑2022 ou 1990‑2022) ou horaire (1990‑2022) — et de la saison, les champs simulés s’accordent très bien avec les données mesurées : la corrélation varie entre 0,92 et 0,98 pour le nombre de jours de pluie et le cumul des précipitations.\n",
        "\n",
        "Cette performance se maintient pour la moyenne des maxima journaliers (périodes 1959‑2022 et 1990‑2022) sur l’année hydrologique, l’automne, l’hiver et le printemps, mais elle se dégrade en été, avec une corrélation de 0,85. À l’échelle horaire, la qualité de l’estimation des maxima se détériore encore : la corrélation baisse de 0,4 à 0,8 point selon la saison pour l’année hydrologique, l’automne et l’hiver, et chute à 0,70 au printemps et en été. "
      ],
      "id": "1513077d"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "plot_r_by_season(combined, echelles=['quotidien', 'quotidien_reduce', 'horaire'], col_values=['numday', 'mean', 'mean-max'], nom_fichier=\"histo_numday_mean_mean-max\")"
      ],
      "id": "24da57a1",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "![](figures/histo_numday_mean_mean-max.png){width=100%}\n",
        "\n",
        "\\captionof{figure}{\\small Corrélations des données climatologiques entre le modèle AROME et les stations Météo-France pour chacune des sources de données.}\n",
        "\n",
        "::: {.callout}\n",
        "AROME sous‑représente les extrêmes convectifs estivaux, surtout à l’échelle horaire, malgré une structure spatiale bien captée.\n",
        ":::\n",
        "\n",
        "### Evaluation des tendances des précipitations extrêmes\n",
        "\n",
        "Nous évaluons à présent les tendances des niveaux de retour décennaux (T = 10 ans) *significatifs* des précipitations, en visualisant leur hétérogénéité spatiale et saisonnière et en quantifiant leur amplitude et leur significativité statistique afin d’identifier les régions et périodes où l’intensification des extrêmes est la plus marquée.\n",
        "\n",
        "#### Distribution spatiale\n",
        "\n",
        "Comme précédemment on commence par analyser la distribution spatiale des tendances d'AROME au regard des observations.\n",
        "\n",
        "##### Données journalières\n",
        "\n",
        "Nous commençons par vérifier que notre méthodologie restitue bien les tendances déjà établies à l’échelle journalière sur 1959‑2022 — période longue, largement documentée — de façon à valider les signaux avant de descendre au pas horaire. \n",
        "\n",
        "Les tendances relatives de 1995 à 2022 estimées avec AROME sont spatialement hétérogènes (Annexes 2‑4.1.1.2, **HYDRO**). Seul le Mercantour se distingue par une hausse significative comprise entre +20 et +30 %. Les stations montrent par ailleurs un signal positif généralisé le long de la vallée du Rhône, avec des tendances de +5 à >+30 %. Hors de ces zones, les tendances sont faibles, de signe variable et le plus souvent non significatives, ce qui plaide pour une analyse saisonnière (Figure 7)."
      ],
      "id": "7c89c361"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "trend_pluie_hydro = assemble(\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_9/sat_99.0/hydro/mod_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_9/sat_99.0/hydro/obs_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_9/sat_99.0/legend_signif.svg\",\n",
        "  \"figures/trend_pluie_hydro.svg\"\n",
        ")\n",
        "df_trend_pluie_hydro = combined_all.loc[(combined_all[\"echelle\"] == \"quotidien\") & (combined_all[\"season\"] == \"hydro\") & (combined_all[\"col_calculate\"] == \"z_T_p_signif\"), [\"n\", \"r\", \"me\", \"delta\"]]\n",
        "\n",
        "trend_pluie_son = assemble(\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_9/sat_99.0/son/mod_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_9/sat_99.0/son/obs_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_9/sat_99.0/legend_signif.svg\",\n",
        "  \"figures/trend_pluie_son.svg\"\n",
        ")\n",
        "df_trend_pluie_son = combined_all.loc[(combined_all[\"echelle\"] == \"quotidien\") & (combined_all[\"season\"] == \"son\") & (combined_all[\"col_calculate\"] == \"z_T_p_signif\"), [\"n\", \"r\", \"me\", \"delta\"]]\n",
        "\n",
        "trend_pluie_djf = assemble(\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_9/sat_99.0/djf/mod_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_9/sat_99.0/djf/obs_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_9/sat_99.0/legend_signif.svg\",\n",
        "  \"figures/trend_pluie_djf.svg\"\n",
        ")\n",
        "df_trend_pluie_djf = combined_all.loc[(combined_all[\"echelle\"] == \"quotidien\") & (combined_all[\"season\"] == \"djf\") & (combined_all[\"col_calculate\"] == \"z_T_p_signif\"), [\"n\", \"r\", \"me\", \"delta\"]]\n",
        "\n",
        "trend_pluie_mam = assemble(\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_9/sat_99.0/mam/mod_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_9/sat_99.0/mam/obs_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_9/sat_99.0/legend_signif.svg\",\n",
        "  \"figures/trend_pluie_mam.svg\"\n",
        ")\n",
        "df_trend_pluie_mam = combined_all.loc[(combined_all[\"echelle\"] == \"quotidien\") & (combined_all[\"season\"] == \"mam\") & (combined_all[\"col_calculate\"] == \"z_T_p_signif\"), [\"n\", \"r\", \"me\", \"delta\"]]\n",
        "\n",
        "trend_pluie_jja = assemble(\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_9/sat_99.0/jja/mod_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_9/sat_99.0/jja/obs_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_9/sat_99.0/legend_signif.svg\",\n",
        "  \"figures/trend_pluie_jja.svg\"\n",
        ")\n",
        "df_trend_pluie_jja = combined_all.loc[(combined_all[\"echelle\"] == \"quotidien\") & (combined_all[\"season\"] == \"jja\") & (combined_all[\"col_calculate\"] == \"z_T_p_signif\"), [\"n\", \"r\", \"me\", \"delta\"]]\n",
        "\n",
        "trend_pluie_ond = assemble(\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_9/sat_99.0/ond/mod_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_9/sat_99.0/ond/obs_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_9/sat_99.0/legend_signif.svg\",\n",
        "  \"figures/trend_pluie_ond.svg\"\n",
        ")\n",
        "df_trend_pluie_ond = combined_all.loc[(combined_all[\"echelle\"] == \"quotidien\") & (combined_all[\"season\"] == \"ond\") & (combined_all[\"col_calculate\"] == \"z_T_p_signif\"), [\"n\", \"r\", \"me\", \"delta\"]]\n",
        "\n",
        "trend_pluie_jfm = assemble(\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_9/sat_99.0/jfm/mod_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_9/sat_99.0/jfm/obs_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_9/sat_99.0/legend_signif.svg\",\n",
        "  \"figures/trend_pluie_jfm.svg\"\n",
        ")\n",
        "df_trend_pluie_jfm = combined_all.loc[(combined_all[\"echelle\"] == \"quotidien\") & (combined_all[\"season\"] == \"jfm\") & (combined_all[\"col_calculate\"] == \"z_T_p_signif\"), [\"n\", \"r\", \"me\", \"delta\"]]\n",
        "\n",
        "trend_pluie_amj = assemble(\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_9/sat_99.0/amj/mod_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_9/sat_99.0/amj/obs_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_9/sat_99.0/legend_signif.svg\",\n",
        "  \"figures/trend_pluie_amj.svg\"\n",
        ")\n",
        "df_trend_pluie_amj = combined_all.loc[(combined_all[\"echelle\"] == \"quotidien\") & (combined_all[\"season\"] == \"amj\") & (combined_all[\"col_calculate\"] == \"z_T_p_signif\"), [\"n\", \"r\", \"me\", \"delta\"]]\n",
        "\n",
        "trend_pluie_jas = assemble(\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_9/sat_99.0/jas/mod_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_9/sat_99.0/jas/obs_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_9/sat_99.0/legend_signif.svg\",\n",
        "  \"figures/trend_pluie_jas.svg\"\n",
        ")\n",
        "df_trend_pluie_jas = combined_all.loc[(combined_all[\"echelle\"] == \"quotidien\") & (combined_all[\"season\"] == \"jas\") & (combined_all[\"col_calculate\"] == \"z_T_p_signif\"), [\"n\", \"r\", \"me\", \"delta\"]]"
      ],
      "id": "8a632277",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "\\newpage\n",
        "\\newgeometry{left=0.2cm,right=0.2cm,top=0.2cm,bottom=0.2cm}\n",
        "\n",
        "\\setlength{\\tabcolsep}{0pt}  \n",
        "\n",
        "| | | |\n",
        "| :---: | :---: | :---: |\n",
        "| \\small \\textbf{HYDRO} | \\small \\textbf{SON} | \\small \\textbf{DJF} | \n",
        "| \\small $r =$ `{python} f'{df_trend_pluie_hydro['r'].iloc[0].item():.2f}'` (n = `{python} f'{df_trend_pluie_hydro['n'].iloc[0].item()}'`) | \\small $r =$ `{python} f'{df_trend_pluie_son['r'].iloc[0].item():.2f}'` (n = `{python} f'{df_trend_pluie_son['n'].iloc[0].item()}'`) | \\small $r =$ `{python} f'{df_trend_pluie_djf['r'].iloc[0].item():.2f}'` (n = `{python} f'{df_trend_pluie_djf['n'].iloc[0].item()}'`) |\n",
        "| \\small $ME =$ `{python} f'{df_trend_pluie_hydro['me'].iloc[0].item():+.2f}'`% | \\small $ME =$ `{python} f'{df_trend_pluie_son['me'].iloc[0].item():+.2f}'`% | \\small $ME =$ `{python} f'{df_trend_pluie_djf['me'].iloc[0].item():+.2f}'`% |\n",
        "| ![](figures/trend_pluie_hydro.pdf) | ![](figures/trend_pluie_son.pdf) | ![](figures/trend_pluie_djf.pdf) |\n",
        "\\small \\textbf{MAM} | \\small \\textbf{JJA} | \\small \\textbf{OND} |\n",
        "|  \\small $r =$ `{python} f'{df_trend_pluie_mam['r'].iloc[0].item():.2f}'` (n = `{python} f'{df_trend_pluie_mam['n'].iloc[0].item()}'`) | \\small $r =$ `{python} f'{df_trend_pluie_jja['r'].iloc[0].item():.2f}'` (n = `{python} f'{df_trend_pluie_jja['n'].iloc[0].item()}'`) | \\small $r =$ `{python} f'{df_trend_pluie_ond['r'].iloc[0].item():.2f}'` (n = `{python} f'{df_trend_pluie_ond['n'].iloc[0].item()}'`) | \n",
        "|  \\small $ME =$ `{python} f'{df_trend_pluie_mam['me'].iloc[0].item():+.2f}'`% | \\small $ME =$ `{python} f'{df_trend_pluie_jja['me'].iloc[0].item():+.2f}'`% | \\small $ME =$ `{python} f'{df_trend_pluie_ond['me'].iloc[0].item():+.2f}'`% | \n",
        "|  ![](figures/trend_pluie_mam.pdf) | ![](figures/trend_pluie_jja.pdf) | ![](figures/trend_pluie_ond.pdf) | \n",
        " \\small \\textbf{JFM} | \\small \\textbf{AMJ} | \\small \\textbf{JAS} |\n",
        "| \\small $r =$ `{python} f'{df_trend_pluie_jfm['r'].iloc[0].item():.2f}'` (n = `{python} f'{df_trend_pluie_jfm['n'].iloc[0].item()}'`) | \\small $r =$ `{python} f'{df_trend_pluie_amj['r'].iloc[0].item():.2f}'` (n = `{python} f'{df_trend_pluie_amj['n'].iloc[0].item()}'`) | \\small $r =$ `{python} f'{df_trend_pluie_jas['r'].iloc[0].item():.2f}'` (n = `{python} f'{df_trend_pluie_jas['n'].iloc[0].item()}'`) |\n",
        "| \\small $ME =$ `{python} f'{df_trend_pluie_jfm['me'].iloc[0].item():+.2f}'`% | \\small $ME =$ `{python} f'{df_trend_pluie_amj['me'].iloc[0].item():+.2f}'`% | \\small $ME =$ `{python} f'{df_trend_pluie_jas['me'].iloc[0].item():+.2f}'`% |\n",
        "| ![](figures/trend_pluie_jfm.pdf) | ![](figures/trend_pluie_amj.pdf) | ![](figures/trend_pluie_jas.pdf) |\n",
        "\n",
        "\n",
        "\\captionof{figure}{\\small Analyse saisonnière des tendances relatives de 1995 à 2022 (\\%) du niveau de retour 10 ans significatif entre le modèle AROME (première ligne) et les stations Météo-France (deuxième ligne) avec la corrélation ($r$), le nombre de stations comparés (n) et le biais ($ME$) issues des maxima de précipitations au pas de temps journalier allant de 1959 à 2022.}\n",
        "\n",
        "\\restoregeometry\n",
        "\\\n",
        "\n",
        "À l’automne (**SON**), AROME indique des tendances négatives (−10 à < −30 %) sur le bassin parisien, le versant occidental du Massif central et les pré‑Alpes, et une hausse marquée dans le Mercantour, comme précédemment. Les stations confirment ce schéma, mais avec une diminution moins prononcée sur les pré‑Alpes et un signal haussier plus net sur les Alpes du Nord. La vallée du Rhône se distingue par une augmentation pouvant atteindre localement +40%. En hiver (**DJF**), AROME met en évidence des tendances négatives marquées — jusqu’à −40 % — depuis les Pyrénées orientales jusqu’à la haute crête cévenole ; des diminutions plus modérées (−15 %) affectent également les Alpes du Nord et le Jura. À l’inverse, les façades atlantique nord et manche présentent des tendances positives de +10 à +30%. Les stations confirment ce schéma, tout en étendant la zone de baisse sur les Alpes du Nord. Au printemps (**MAM**), le signal est peu structuré : AROME n’isole pas de pattern net, mais suggère des tendances positives sur la moitié nord et ouest de la France (+15 à +30%). Les stations renforcent ce diagnostic, avec une hausse généralisée sur l’ensemble de la moitié Nord, localement > +35%. En été (**JJA**), AROME met en évidence une baisse généralisée sur la moitié sud de la France, atteignant −10 à <−30% le long de l’arc méditerranéen, avec un noyau de diminution marqué sur les bassins pyrénéens orientaux. Les stations confirment ce motif spatial. \\\n",
        "\n",
        "Globalement, AROME reproduit la distribution spatiale des tendances observées, mais avec une faible corrélation et une extension parfois réduite — sur les Alpes du Nord en automne et en hiver, ainsi que sur la moitié nord de la France au printemps — et sous‑estime systématiquement leur amplitude, avec un biais moyen compris entre −2,42% (MAM) et −4,87% (HYDRO).\n",
        "\n",
        "##### Données horaires\n",
        "\n",
        "Nous passons désormais à l’échelle horaire afin d’évaluer l’éventuelle intensification des extrêmes infra‑journaliers. Face à l’hétérogénéité spatiale persistante des tendances saisonnières (Annexes 2‑4.3.1.2, HYDRO, SON, DJF, MAM et JJA), nous affinons l’analyse au pas mensuel (Figure 8).\n"
      ],
      "id": "49033568"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "trend_horaire_pluie_hydro = assemble(\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_9/sat_90.0/hydro/mod_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_9/sat_90.0/hydro/obs_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_9/sat_90.0/legend_signif.svg\",\n",
        "  \"figures/trend_horaire_pluie_hydro.svg\"\n",
        ")\n",
        "df_trend_horaire_pluie_hydro = combined_all.loc[(combined_all[\"echelle\"] == \"horaire\") & (combined_all[\"season\"] == \"hydro\") & (combined_all[\"col_calculate\"] == \"z_T_p_signif\"), [\"n\", \"r\", \"me\", \"delta\"]]\n",
        "\n",
        "trend_horaire_pluie_son = assemble(\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_9/sat_90.0/son/mod_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_9/sat_90.0/son/obs_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_9/sat_90.0/legend_signif.svg\",\n",
        "  \"figures/trend_horaire_pluie_son.svg\"\n",
        ")\n",
        "df_trend_horaire_pluie_son = combined_all.loc[(combined_all[\"echelle\"] == \"horaire\") & (combined_all[\"season\"] == \"son\") & (combined_all[\"col_calculate\"] == \"z_T_p_signif\"), [\"n\", \"r\", \"me\", \"delta\"]]\n",
        "\n",
        "trend_horaire_pluie_djf = assemble(\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_9/sat_90.0/djf/mod_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_9/sat_90.0/djf/obs_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_9/sat_90.0/legend_signif.svg\",\n",
        "  \"figures/trend_horaire_pluie_djf.svg\"\n",
        ")\n",
        "df_trend_horaire_pluie_djf = combined_all.loc[(combined_all[\"echelle\"] == \"horaire\") & (combined_all[\"season\"] == \"djf\") & (combined_all[\"col_calculate\"] == \"z_T_p_signif\"), [\"n\", \"r\", \"me\", \"delta\"]]\n",
        "\n",
        "trend_horaire_pluie_mam = assemble(\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_9/sat_90.0/mam/mod_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_9/sat_90.0/mam/obs_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_9/sat_90.0/legend_signif.svg\",\n",
        "  \"figures/trend_horaire_pluie_mam.svg\"\n",
        ")\n",
        "df_trend_horaire_pluie_mam = combined_all.loc[(combined_all[\"echelle\"] == \"horaire\") & (combined_all[\"season\"] == \"mam\") & (combined_all[\"col_calculate\"] == \"z_T_p_signif\"), [\"n\", \"r\", \"me\", \"delta\"]]\n",
        "\n",
        "trend_horaire_pluie_jja = assemble(\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_9/sat_90.0/jja/mod_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_9/sat_90.0/jja/obs_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_9/sat_90.0/legend_signif.svg\",\n",
        "  \"figures/trend_horaire_pluie_jja.svg\"\n",
        ")\n",
        "df_trend_horaire_pluie_jja = combined_all.loc[(combined_all[\"echelle\"] == \"horaire\") & (combined_all[\"season\"] == \"jja\") & (combined_all[\"col_calculate\"] == \"z_T_p_signif\"), [\"n\", \"r\", \"me\", \"delta\"]]\n",
        "\n",
        "trend_horaire_pluie_ond = assemble(\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_9/sat_90.0/ond/mod_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_9/sat_90.0/ond/obs_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_9/sat_90.0/legend_signif.svg\",\n",
        "  \"figures/trend_horaire_pluie_ond.svg\"\n",
        ")\n",
        "df_trend_horaire_pluie_ond = combined_all.loc[(combined_all[\"echelle\"] == \"horaire\") & (combined_all[\"season\"] == \"ond\") & (combined_all[\"col_calculate\"] == \"z_T_p_signif\"), [\"n\", \"r\", \"me\", \"delta\"]]\n",
        "\n",
        "trend_horaire_pluie_jfm = assemble(\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_9/sat_90.0/jfm/mod_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_9/sat_90.0/jfm/obs_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_9/sat_90.0/legend_signif.svg\",\n",
        "  \"figures/trend_horaire_pluie_jfm.svg\"\n",
        ")\n",
        "df_trend_horaire_pluie_jfm = combined_all.loc[(combined_all[\"echelle\"] == \"horaire\") & (combined_all[\"season\"] == \"jfm\") & (combined_all[\"col_calculate\"] == \"z_T_p_signif\"), [\"n\", \"r\", \"me\", \"delta\"]]\n",
        "\n",
        "trend_horaire_pluie_amj = assemble(\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_9/sat_90.0/amj/mod_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_9/sat_90.0/amj/obs_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_9/sat_90.0/legend_signif.svg\",\n",
        "  \"figures/trend_horaire_pluie_amj.svg\"\n",
        ")\n",
        "df_trend_horaire_pluie_amj = combined_all.loc[(combined_all[\"echelle\"] == \"horaire\") & (combined_all[\"season\"] == \"amj\") & (combined_all[\"col_calculate\"] == \"z_T_p_signif\"), [\"n\", \"r\", \"me\", \"delta\"]]\n",
        "\n",
        "trend_horaire_pluie_jas = assemble(\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_9/sat_90.0/jas/mod_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_9/sat_90.0/jas/obs_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_9/sat_90.0/legend_signif.svg\",\n",
        "  \"figures/trend_horaire_pluie_jas.svg\"\n",
        ")\n",
        "df_trend_horaire_pluie_jas = combined_all.loc[(combined_all[\"echelle\"] == \"horaire\") & (combined_all[\"season\"] == \"jas\") & (combined_all[\"col_calculate\"] == \"z_T_p_signif\"), [\"n\", \"r\", \"me\", \"delta\"]]"
      ],
      "id": "2d1e3076",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "\\newpage\n",
        "\\newgeometry{left=0.2cm,right=0.2cm,top=0.2cm,bottom=0.2cm}\n",
        "\n",
        "\\setlength{\\tabcolsep}{0pt}  \n",
        "\n",
        "| | | |\n",
        "| :---: | :---: | :---: |\n",
        "| \\small \\textbf{HYDRO} | \\small \\textbf{SON} | \\small \\textbf{DJF} | \n",
        "| \\small $r =$ `{python} f'{df_trend_horaire_pluie_hydro['r'].iloc[0].item():.2f}'` (n = `{python} f'{df_trend_horaire_pluie_hydro['n'].iloc[0].item()}'`) | \\small $r =$ `{python} f'{df_trend_horaire_pluie_son['r'].iloc[0].item():.2f}'` (n = `{python} f'{df_trend_horaire_pluie_son['n'].iloc[0].item()}'`) | \\small $r =$ `{python} f'{df_trend_horaire_pluie_djf['r'].iloc[0].item():.2f}'` (n = `{python} f'{df_trend_horaire_pluie_djf['n'].iloc[0].item()}'`) |\n",
        "| \\small $ME =$ `{python} f'{df_trend_horaire_pluie_hydro['me'].iloc[0].item():+.2f}'`% | \\small $ME =$ `{python} f'{df_trend_horaire_pluie_son['me'].iloc[0].item():+.2f}'`% | \\small $ME =$ `{python} f'{df_trend_horaire_pluie_djf['me'].iloc[0].item():+.2f}'`% |\n",
        "| ![](figures/trend_horaire_pluie_hydro.pdf) | ![](figures/trend_horaire_pluie_son.pdf) | ![](figures/trend_horaire_pluie_djf.pdf) |\n",
        "\\small \\textbf{MAM} | \\small \\textbf{JJA} | \\small \\textbf{OND} |\n",
        "|  \\small $r =$ `{python} f'{df_trend_horaire_pluie_mam['r'].iloc[0].item():.2f}'` (n = `{python} f'{df_trend_horaire_pluie_mam['n'].iloc[0].item()}'`) | \\small $r =$ `{python} f'{df_trend_horaire_pluie_jja['r'].iloc[0].item():.2f}'` (n = `{python} f'{df_trend_horaire_pluie_jja['n'].iloc[0].item()}'`) | \\small $r =$ `{python} f'{df_trend_horaire_pluie_ond['r'].iloc[0].item():.2f}'` (n = `{python} f'{df_trend_horaire_pluie_ond['n'].iloc[0].item()}'`) | \n",
        "|  \\small $ME =$ `{python} f'{df_trend_horaire_pluie_mam['me'].iloc[0].item():+.2f}'`% | \\small $ME =$ `{python} f'{df_trend_horaire_pluie_jja['me'].iloc[0].item():+.2f}'`% | \\small $ME =$ `{python} f'{df_trend_horaire_pluie_ond['me'].iloc[0].item():+.2f}'`% | \n",
        "|  ![](figures/trend_horaire_pluie_mam.pdf) | ![](figures/trend_horaire_pluie_jja.pdf) | ![](figures/trend_horaire_pluie_ond.pdf) | \n",
        " \\small \\textbf{JFM} | \\small \\textbf{AMJ} | \\small \\textbf{JAS} |\n",
        "| \\small $r =$ `{python} f'{df_trend_horaire_pluie_jfm['r'].iloc[0].item():.2f}'` (n = `{python} f'{df_trend_horaire_pluie_jfm['n'].iloc[0].item()}'`) | \\small $r =$ `{python} f'{df_trend_horaire_pluie_amj['r'].iloc[0].item():.2f}'` (n = `{python} f'{df_trend_horaire_pluie_amj['n'].iloc[0].item()}'`) | \\small $r =$ `{python} f'{df_trend_horaire_pluie_jas['r'].iloc[0].item():.2f}'` (n = `{python} f'{df_trend_horaire_pluie_jas['n'].iloc[0].item()}'`) |\n",
        "| \\small $ME =$ `{python} f'{df_trend_horaire_pluie_jfm['me'].iloc[0].item():+.2f}'`% | \\small $ME =$ `{python} f'{df_trend_horaire_pluie_amj['me'].iloc[0].item():+.2f}'`% | \\small $ME =$ `{python} f'{df_trend_horaire_pluie_jas['me'].iloc[0].item():+.2f}'`% |\n",
        "| ![](figures/trend_horaire_pluie_jfm.pdf) | ![](figures/trend_horaire_pluie_amj.pdf) | ![](figures/trend_horaire_pluie_jas.pdf) |\n",
        "\n",
        "\n",
        "\\captionof{figure}{\\small Analyse saisonnière des tendances relatives de 1995 à 2022 (\\%) du niveau de retour 10 ans significatif entre le modèle AROME (première ligne) et les stations Météo-France (deuxième ligne) avec la corrélation ($r$), le nombre de stations comparés (n) et le biais ($ME$) issues des maxima de précipitations au pas de temps horaire allant de 1990 à 2022.}\n",
        "\n",
        "\\restoregeometry\n",
        "\\\n",
        "\n",
        "\n",
        "\n",
        "#### MOIS"
      ],
      "id": "7ad1ff6c"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "trend_pluie_quotidien_fev = assemble(\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_12/sat_99.0/fev/mod_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_12/sat_99.0/fev/obs_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_12/sat_99.0/legend_signif.svg\",\n",
        "  \"figures/trend_pluie_quotidien_fev.svg\"\n",
        ")\n",
        "df_trend_quotidien_pluie_fev = combined_all.loc[(combined_all[\"echelle\"] == \"quotidien\") & (combined_all[\"season\"] == \"fev\") & (combined_all[\"col_calculate\"] == \"z_T_p_signif\"), [\"n\", \"r\", \"me\", \"delta\"]]\n",
        "\n",
        "trend_pluie_quotidien_mar = assemble(\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_12/sat_99.0/mar/mod_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_12/sat_99.0/mar/obs_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_12/sat_99.0/legend_signif.svg\",\n",
        "  \"figures/trend_pluie_quotidien_mar.svg\"\n",
        ")\n",
        "df_trend_quotidien_pluie_mar = combined_all.loc[(combined_all[\"echelle\"] == \"quotidien\") & (combined_all[\"season\"] == \"mar\") & (combined_all[\"col_calculate\"] == \"z_T_p_signif\"), [\"n\", \"r\", \"me\", \"delta\"]]\n",
        "\n",
        "trend_pluie_quotidien_jui = assemble(\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_12/sat_99.0/nov/mod_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_12/sat_99.0/nov/obs_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_12/sat_99.0/legend_signif.svg\",\n",
        "  \"figures/trend_pluie_quotidien_jui.svg\"\n",
        ")\n",
        "df_trend_quotidien_pluie_jui = combined_all.loc[(combined_all[\"echelle\"] == \"quotidien\") & (combined_all[\"season\"] == \"jui\") & (combined_all[\"col_calculate\"] == \"z_T_p_signif\"), [\"n\", \"r\", \"me\", \"delta\"]]\n",
        "\n",
        "trend_pluie_quotidien_nov = assemble(\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_12/sat_99.0/nov/mod_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_12/sat_99.0/nov/obs_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/quotidien/compare_12/sat_99.0/legend_signif.svg\",\n",
        "  \"figures/trend_pluie_quotidien_nov.svg\"\n",
        ")\n",
        "df_trend_quotidien_pluie_nov = combined_all.loc[(combined_all[\"echelle\"] == \"quotidien\") & (combined_all[\"season\"] == \"nov\") & (combined_all[\"col_calculate\"] == \"z_T_p_signif\"), [\"n\", \"r\", \"me\", \"delta\"]]"
      ],
      "id": "f016404e",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "\\newpage\n",
        "\\newgeometry{left=0.2cm,right=0.2cm,top=0.2cm,bottom=0.2cm}\n",
        "\n",
        "\\setlength{\\tabcolsep}{0pt}  \n",
        "\n",
        "| | | |\n",
        "| :---: | :---: | :---: | :---: |\n",
        "| \\small \\textbf{FEV} | \\small \\textbf{MAR} | \\small \\textbf{JUI} | \\small \\textbf{NOV} | \n",
        "| \\small $r =$ `{python} f'{df_trend_quotidien_pluie_fev['r'].iloc[0].item():.2f}'` (n = `{python} f'{df_trend_quotidien_pluie_fev['n'].iloc[0].item()}'`) | \\small $r =$ `{python} f'{df_trend_quotidien_pluie_mar['r'].iloc[0].item():.2f}'` (n = `{python} f'{df_trend_quotidien_pluie_mar['n'].iloc[0].item()}'`) | \\small $r =$ `{python} f'{df_trend_quotidien_pluie_jui['r'].iloc[0].item():.2f}'` (n = `{python} f'{df_trend_quotidien_pluie_jui['n'].iloc[0].item()}'`) | \\small $r =$ `{python} f'{df_trend_quotidien_pluie_nov['r'].iloc[0].item():.2f}'` (n = `{python} f'{df_trend_quotidien_pluie_nov['n'].iloc[0].item()}'`) |\n",
        "| \\small $ME =$ `{python} f'{df_trend_quotidien_pluie_fev['me'].iloc[0].item():+.2f}'`% | \\small $ME =$ `{python} f'{df_trend_quotidien_pluie_mar['me'].iloc[0].item():+.2f}'`% | \\small $ME =$ `{python} f'{df_trend_quotidien_pluie_jui['me'].iloc[0].item():+.2f}'`% | \\small $ME =$ `{python} f'{df_trend_quotidien_pluie_nov['me'].iloc[0].item():+.2f}'`% |\n",
        "| ![](figures/trend_quotidien_pluie_fev.pdf) | ![](figures/trend_quotidien_pluie_mar.pdf) | ![](figures/trend_quotidien_pluie_jui.pdf) | ![](figures/trend_quotidien_pluie_nov.pdf) |\n",
        "\n",
        "\\captionof{figure}{\\small Analyse saisonnière des trendances relatives de 1995 à 2022 (\\%) du niveau de retour 10 ans significatif entre le modèle AROME (première ligne) et les stations Météo-France (deuxième ligne) avec la corrélation ($r$), le nombre de stations comparés (n) et le biais ($ME$) issues des maxima de précipitations au pas de temps journalier allant de 1959 à 2022.}\n",
        "\n",
        "\\restoregeometry\n",
        "\\\n"
      ],
      "id": "db2b0609"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "trend_pluie_horaire_fev = assemble(\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_12/sat_90.0/fev/mod_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_12/sat_90.0/fev/obs_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_12/sat_90.0/legend_signif.svg\",\n",
        "  \"figures/trend_pluie_horaire_fev.svg\"\n",
        ")\n",
        "df_trend_horaire_pluie_fev = combined_all.loc[(combined_all[\"echelle\"] == \"horaire\") & (combined_all[\"season\"] == \"fev\") & (combined_all[\"col_calculate\"] == \"z_T_p_signif\"), [\"n\", \"r\", \"me\", \"delta\"]]\n",
        "\n",
        "trend_pluie_horaire_mar = assemble(\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_12/sat_90.0/mar/mod_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_12/sat_90.0/mar/obs_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_12/sat_90.0/legend_signif.svg\",\n",
        "  \"figures/trend_pluie_horaire_mar.svg\"\n",
        ")\n",
        "df_trend_horaire_pluie_mar = combined_all.loc[(combined_all[\"echelle\"] == \"horaire\") & (combined_all[\"season\"] == \"mar\") & (combined_all[\"col_calculate\"] == \"z_T_p_signif\"), [\"n\", \"r\", \"me\", \"delta\"]]\n",
        "\n",
        "trend_pluie_horaire_jui = assemble(\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_12/sat_90.0/nov/mod_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_12/sat_90.0/nov/obs_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_12/sat_90.0/legend_signif.svg\",\n",
        "  \"figures/trend_pluie_horaire_jui.svg\"\n",
        ")\n",
        "df_trend_horaire_pluie_jui = combined_all.loc[(combined_all[\"echelle\"] == \"horaire\") & (combined_all[\"season\"] == \"jui\") & (combined_all[\"col_calculate\"] == \"z_T_p_signif\"), [\"n\", \"r\", \"me\", \"delta\"]]\n",
        "\n",
        "trend_pluie_horaire_nov = assemble(\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_12/sat_90.0/nov/mod_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_12/sat_90.0/nov/obs_signif_norast.svg\",\n",
        "  \"../outputs/maps/gev_z_T_p/horaire/compare_12/sat_90.0/legend_signif.svg\",\n",
        "  \"figures/trend_pluie_horaire_nov.svg\"\n",
        ")\n",
        "df_trend_horaire_pluie_nov = combined_all.loc[(combined_all[\"echelle\"] == \"horaire\") & (combined_all[\"season\"] == \"nov\") & (combined_all[\"col_calculate\"] == \"z_T_p_signif\"), [\"n\", \"r\", \"me\", \"delta\"]]"
      ],
      "id": "eac2b3e3",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "\\newpage\n",
        "\\newgeometry{left=0.2cm,right=0.2cm,top=0.2cm,bottom=0.2cm}\n",
        "\n",
        "\\setlength{\\tabcolsep}{0pt}  \n",
        "\n",
        "| | | |\n",
        "| :---: | :---: | :---: | :---: |\n",
        "| \\small \\textbf{FEV} | \\small \\textbf{MAR} | \\small \\textbf{JUI} | \\small \\textbf{NOV} | \n",
        "| \\small $r =$ `{python} f'{df_trend_horaire_horaire_pluie_fev['r'].iloc[0].item():.2f}'` (n = `{python} f'{df_trend_horaire_horaire_pluie_fev['n'].iloc[0].item()}'`) | \\small $r =$ `{python} f'{df_trend_horaire_horaire_pluie_mar['r'].iloc[0].item():.2f}'` (n = `{python} f'{df_trend_horaire_horaire_pluie_mar['n'].iloc[0].item()}'`) | \\small $r =$ `{python} f'{df_trend_horaire_horaire_pluie_jui['r'].iloc[0].item():.2f}'` (n = `{python} f'{df_trend_horaire_horaire_pluie_jui['n'].iloc[0].item()}'`) | \\small $r =$ `{python} f'{df_trend_horaire_horaire_pluie_nov['r'].iloc[0].item():.2f}'` (n = `{python} f'{df_trend_horaire_horaire_pluie_nov['n'].iloc[0].item()}'`) |\n",
        "| \\small $ME =$ `{python} f'{df_trend_horaire_horaire_pluie_fev['me'].iloc[0].item():+.2f}'`% | \\small $ME =$ `{python} f'{df_trend_horaire_horaire_pluie_mar['me'].iloc[0].item():+.2f}'`% | \\small $ME =$ `{python} f'{df_trend_horaire_horaire_pluie_jui['me'].iloc[0].item():+.2f}'`% | \\small $ME =$ `{python} f'{df_trend_horaire_horaire_pluie_nov['me'].iloc[0].item():+.2f}'`% |\n",
        "| ![](figures/trend_horaire_pluie_fev.pdf) | ![](figures/trend_horaire_pluie_mar.pdf) | ![](figures/trend_horaire_pluie_jui.pdf) | ![](figures/trend_horaire_pluie_nov.pdf) |\n",
        "\n",
        "\\captionof{figure}{\\small Analyse saisonnière des trendances relatives de 1995 à 2022 (\\%) du niveau de retour 10 ans significatif entre le modèle AROME (première ligne) et les stations Météo-France (deuxième ligne) avec la corrélation ($r$), le nombre de stations comparés (n) et le biais ($ME$) issues des maxima de précipitations au pas de temps horaire allant de 1990 à 2022.}\n",
        "\n",
        "\\restoregeometry\n",
        "\\\n",
        "\n",
        "AROME indique des tendances positives (+25 à >+150%) dans la vallée du Rhône et les pré-Alpes en février (**FEV**), sur l'arc méditérannéen ouest (Roussillon–Bas Languedoc) en mars (**MAR**) et est (bassin azuréen) en novembre (**NOV**). Les stations confirment ce schéma, en renforçant nettement le signal sur la vallée du Rhône en février, avec des tendances environ deux fois plus élevées qu’AROME. En juin (Annexes 2-4.3.2.2, **JUI**), AROME et les stations affichent un signal très majoritairement haussier sur l’ensemble du territoire, avec des tendances locales pouvant dépasser +150%. Cependant, la corrélation spatiale extrêmement faible entre les deux jeux de données (*r =* 0,07) indique que, si le signe moyen converge, la localisation des tendances est incohérente/bruitée. Cette discordance, combinée à la forte variabilité convective estivale et à la faible longueur des séries mensuelles (1990–2022), appelle à la prudence.\n",
        "\n",
        "#### Corrélation des tendances relatives entre le modèle AROME et les stations Météo-France\n",
        "\n",
        "Pour objectiver ces divergences et mesurer la robustesse des signaux, nous examinons désormais les corrélations spatiales entre AROME et les stations, par saison et mois, afin d’identifier où l’accord est structurel et où il relève surtout du bruit. \\\n",
        "\n",
        "À l’échelle quotidienne (1959‑2022), les corrélations des tendances se situent entre **0,14** (HYDRO) et **0,23** (DJF) pour les saisons et entre **0,07** (JUI) et **0,51** (DEC) pour les mois, plusieurs mois atteignant ou dépassant **0,40** (JAN, MAR, AOU, NOV) (Figure 9). Sur la période restreinte (1990‑2022), les valeurs saisonnières couvrent **0,13–0,29** et les valeurs mensuelles **0,02–0,47** (JAN **0,47** ; DEC **0,35**). À l’échelle horaire (1990‑2022), les saisons présentent des corrélations faibles comprises entre **–0,08** (MAM) et **0,05** (DJF et SON) et les corrélations suivant les mois s’étendent de **0,02** (SEP, OCT) à **0,42** (FEV)."
      ],
      "id": "e71411c4"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "plot_r_by_season(combined_all , echelles=['quotidien', 'quotidien_reduce', 'horaire'], col_values=['z_T_p_signif'], nom_fichier=\"histo_z_T_p_signif\")\n",
        "plot_r_by_season(combined_all , echelles=['quotidien', 'quotidien_reduce', 'horaire'], col_values=['z_T_p', 'z_T_p_signif'], nom_fichier=\"histo_z_T_p\")"
      ],
      "id": "aeb57c24",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "![](figures/histo_z_T_p.png){width=100%}\n",
        "\n",
        "\\captionof{figure}{\\small Corrélations des tendances relatives (toutes et significatives) entre AROME et les stations Météo‑France, par saison et par mois.} \n",
        "\\\n",
        "\n",
        "En restreignant aux tendances significatives par vraisemblance profilée, l’échelle quotidienne (1959‑2022) affiche des corrélations saisonnières de **0,19** (MAM) à **0,39** (DJF) et des valeurs mensuelles de **0,17** (JUI) à **0,77** (DEC), avec d’autres mois marquant une corrélation élevée (JAN **0,70** ; MAR **0,71** ; NOV **0,68** ; AOU **0,52**). Pour la période restreinte (1990‑2022), les valeurs saisonnières vont de **0,27** (MAM) à **0,44** (DJF) et les valeurs mensuelles de **0,17** (JUILL) à **0,69** (JAN), avec des valeurs supérieures à 0,60 en février, octobre et décembre. À l’échelle horaire (1990‑2022), les valeurs saisonnières couvrent **–0,20–0,13** et les valeurs mensuelles **–0,01–0,66**. La restriction aux tendances significatives augmente fortement les corrélations quotidiennes, avec des maxima mensuels élevés. Le gain est marqué en hiver et en fin d’été / automne (JAN, MAR, NOV, DEC, AOU). À l’échelle horaire, même après filtrage, l’amélioration reste partielle : quelques mois s'améliorent (FEV) mais plusieurs périodes sont marquées par des corrélations proches de zéro ou légèrement négatives (MAI, SEP).\n",
        "\n",
        "##### Saisonnalité récurrente de la performance\n",
        "\n",
        "L'hiver (DJF) et les mois hivernaux isolés (DEC, JAN, MAR) concentrent les plus fortes corrélations, que ce soit sur la période longue ou restreinte, et surtout après filtrage. Le printemps (MAM) et le début d’été (JUI, JUILL) affichent systématiquement les valeurs les plus basses (ou minima) dans chaque configuration. La fin d’été / automne (AOU, NOV) fournit des corrélations intermédiaires à élevées une fois les tendances significatives retenues.\n",
        "\n",
        "##### Hiérarchie claire des échelles temporelles\n",
        "\n",
        "L'étude journalière est systématiquement plus cohérente spatialement pour les tendances que l'étude horaire. Le filtrage de significativité transforme la distribution journalière (multiplication des mois >0,60), alors qu’il ne suffit pas à hisser l’horaire à un niveau comparable (un seul mois >0,60).\n",
        "\n",
        "## Discussion\n",
        "\n",
        "#### Fidélité spatiale de la climatologie simulée\n",
        "\n",
        "Les résultats confirment qu’AROME reproduit correctement les grands régimes pluviométriques hexagonaux confirmé par la littérature [@Fumiere2020], [@caillaud2021simulation], [@hess-28-2579-2024], [@LucasPicher2024]. Il y a un excédent orographique sur les Alpes, les Pyrénées et le Massif central, un gradient atlantique‑continental marqué à l’ouest et un déficit fréquentiel sur le pourtour méditerranéen. Cette cohérence avec la réalité mesurée témoigne d’une représentation satisfaisante des forçages dynamiques (transport d’humidité par les flux d’ouest, soulèvement orographique, circulation de basse couche en Méditerranée). \n",
        "\n",
        "#### Variabilité saisonnière et représentation des extrêmes\n",
        "\n",
        "La capacité d’AROME à restituer la fréquence et la quantité de précipitations se maintient tout au long de l’année, mais la performance chute pour la moyenne des maxima journaliers en été et davantage à l’échelle horaire. On retrouve le fait qu'AROME sous-estime des précipitations d'intensité élévées (> 40 mm/h [@Caillaud2021], [@poncet2024convection]) La convection estivale reste partiellement sous‑résolue malgré la résolution spatiale de 2,5 km. Dans cette étude, on a pu montrer (résultats non affichés) que la corrélation augmente lorsque la fenêtre temporelle s'agrandit à 6 ou 9h. Le modèle pourrait reproduire la cellule orageuse en démarrant trop tard ou trop tôt, en étalant l’intensité sur plusieurs mailles (non évalué par manque de stations) ou en sous‑estimant les précipitations maximales. Le pas de 2–3 km est une étape majeure pour représenter la convection sans paramétrage, mais il reste trop grossier pour certaines applications sensibles aux maxima intenses [@Prein2015Review]. Il aurait été intéressant d'introduire les données COMEPHORE (1 km, 15 min) de Météo-France dans cette étude mais les réanalyses radar ne débutent qu'en 1997 avec une qualité médiocre sur les Alpes avant 2007 [@Fumiere2020].\n",
        "\n",
        "#### Tendances des extrêmes de précipitations : cohérences, divergences et limites\n",
        "\n",
        "##### Données journalière\n",
        "\n",
        "La tendance positive et significative sont cohérentes avec l'étude à l'échelle terrestre de l'@IPCC2021 montrant une hausse du niveau de retour 10 ans de +6,7% issu des pluies journalières pour 71% de la surface. Les hot-spots sur le Mercantour (+20 à +30 %) et, côté stations, sur la vallée du Rhône (+5 à < +30 %) sont cohérents avec les travaux montrant une intensification des extrêmes dans le Sud‑Est de la France et sur les Alpes du Sud de @blanchet2021explaining. En automne une augmentation du niveau de retour 20 ans pourrait atteindre l’ordre de grandeur de sa valeur moyenne dans le sud‑est alpin. Les tendances haussières marquées des stations (> +35%) sur la moitié Nord de la France résonnent avec les projections françaises qui anticipent des augmentations plus fortes des extrêmes journaliers dans le Nord sous réchauffement (+20% pour +4°C) montré par @soubeyroux:hal-04991790. Le biais moyen négatif (−2,4 % à −4,9 %) signifie que le modèle aplatit systématiquement les tendances par rapport aux observations, à relier à la représentation des extrêmes par AROME.\n",
        "\n",
        "##### Données horaires\n",
        "\n",
        "Les signaux sont beaucoup moins robuste au pas de temps horaire qu'au pas de temps journalier. Ils montrent des tendances très hétérogènes, souvent peu ou pas significatives, et parfois incohérentes spatialement entre AROME et les stations (en juin, *r =* 0,07). Cela rejoint le constat de @IPCC2021 concernant la faible confiance dans une hausse globale des extrêmes sous‑journaliers, faute de séries longues, denses et homogènes. Les hausses marquées en février (vallée du Rhône, pré‑Alpes), mars (arc méditerranéen ouest) et novembre (arc méditerranéen est) sont compatibles avec les régimes dynamiques et thermo‑marins propices aux épisodes méditerranéens/transitionnels (fin d’hiver, intersaison automnale). Le signal doublé par les stations en février sur la vallée du Rhône souligne le lissages et biais d’amplitude d’AROME sur les extrêmes horaires. Toutefois, la période restreinte (1990–2022) offre peu de puissance statistique, et la variabilité interannuelle convective peut cacher ou mimer une tendance. En juin, la hausse généralisée (jusqu’à +150%), mais sans accord spatial entre AROME et stations montre la variabilité convective locale (orages très ponctuels) et les erreurs de représentativité point *vs.* maille deviennent dominantes. C'est un exemple des limites de l’inférence mensuelle sur les extrêmes convectifs. \\\n",
        "\n",
        "DeS études régionales mettent en évidence des sensibilités infra‑journalières de +7 à +13%/°C, parfois supérieures à Clausius‑Clapeyron, notamment pour des orages convectifs brefs [@molnar2015relation]. L'étude n'identifie pas de signal clair avec le modèle AROME qui sous‑estime fortement les pics horaires, alors que les stations captent des pointes locales. C'est ce à quoi on s'attendait au regard de la part des tendances des extrêmes liée à Clausius-Clapeyron qui devait théoriquement être deux fois plus faible que les tendances observées.\n",
        "\n",
        "#### Robustesse statistique des signaux\n",
        "\n",
        "Une fenêtre longue (1959–2022) réduit les incertitudes d’estimation et échantillonne plusieurs régimes climatiques (phase de global dimming dominée par les aérosols jusqu’aux années 1980, puis accélération du réchauffement à partir de la fin des années 1980–1990). Ce mélange de régimes atténue mécaniquement la pente moyenne : une partie du signal récent est noyée dans la variabilité multidécennale. À l’inverse, une fenêtre courte (1990–2022) isole le régime dominé par le réchauffement rapide, la diminution des aérosols sulfatés en Europe et l’accroissement quasi linéaire du contenu en vapeur d’eau (+7%/°C), ce qui fait ressortir des tendances positives plus nettes. Les deux diagnostics sont donc complémentaires et doivent être interprétés séparément pour ne pas confondre bruit multidécennal et forçage anthropique de long terme. \\\n",
        "\n",
        "En première approximation, les distributions mensuelles des tendances relatives du niveau de retour 10 ans sont centrées sur 0% sur 1959–2022, tandis que 1990–2022 montre un léger basculement vers des accroissements, surtout au printemps et en début d’hiver, en phase avec la littérature sur l’amplification récente des extrêmes journaliers. Même si des points de rupture ont été autorisés lorsque le LRT le justifiait, la transition progressive (environ 10 ans) entre l’ère du dimming et le régime chaud post‑1985 reste en partie absorbée par les modèles longue fenêtre, ce qui réduit la pente moyenne par rapport aux modèles courte fenêtre qui se calent sur la portion quasi linéaire récente. Ceci éclaire, par exemple, la tendance nationale moyenne observée de −1,6% sur 1959–2022 contre +3,5% sur 1990–2022. \\\n",
        "\n",
        "Ces différences sont également attendues d’un point de vue statistique : @DeGaetano2018 montre que, pour des tendances > 0,5%/an sur le paramètre de localisation $\\mu$, réduire la fenêtre de 60 à 30 ans peut modifier la pente estimée des niveaux de retour décennaux de 10 à 20 %. Autrement dit, la longueur de la fenêtre et la (non)‑stationnarité du climat pèsent fortement sur l’estimation des tendances, même lorsque des points de rupture détectés par LRT sont intégrés.\n",
        "\n",
        "#### Signal hivernal, bruit horaire : le filtrage renforce la cohérence mais AROME peine sur les extrêmes fins\n",
        "\n",
        "En ne gardant que les tendances significatives on élimine nombre de sites où le signal est dominé par le bruit climatique, améliorant la cohérence spatiale des tendances et donc les diagnostics régionaux. À l’échelle journalière, les valeurs mensuelles des corrélations AROME–stations oscillent entre 0,40 et 0,77 après filtrage par significativité, contre moins de 0,20 à l’échelle horaire. Ce saut serait à relier à la difficulté d'AROME à expliquer les maxima convectifs fins au pas de temps horaire. \\\n",
        "\n",
        "Le découpage saisonnier met en lumière une hiérarchie marquée par l’hiver (DJF) qui concentre systématiquement les corrélations les plus fortes et des hausses modérées à marquées des niveaux de retour. En hiver, les précipitations en Europe occidentale viennent des perturbations atlantiques véhiculées par les flux d’ouest. Leur intensité dépend directement de la quantité de vapeur d’eau dans ces masses d’air, qui augmente avec la température selon la loi de Clausius–Clapeyron. C’est pourquoi des hivers plus doux peuvent parfois être aussi plus pluvieux, même avec une dynamique atmosphérique identique. Le printemps et le début d’été (MAM–JUI) enregistrent au contraire les minima de corrélation systématiques. Cela révèle la difficulté persistante, même à résolution 2,5 km, à représenter la convection faiblement organisée typique de cette saison. Le réchauffement diurne déclenche surtout des orages isolés d’origine locale. L’influence des perturbations atlantiques diminue, car le jet‑stream et ses systèmes frontaux se déplacent vers le nord. Le cisaillement vertical s’affaiblit, empêchant l’organisation des orages en structures durables. Il en résulte des précipitations brèves, très localisées et peu structurées que le couple simulation–observations capture encore mal. En août et septembre, la convergence relative des distributions (médianes proches et corrélations < 0,20) traduit une variabilité élevée et une contribution partagée entre épisodes orageux continentaux et systèmes méditerranéens précoces. La mixité des mécanismes pluvieux réduit la cohérence entre sites et la capacité d’AROME à reproduire la saisonnalité des tendances.\n",
        "\n",
        "#### Signaux régionaux : focus sur la vallée du Rhône\n",
        "\n",
        "La vallée du Rhône semble être un « hot‑spot » des tendances positives du niveau de retour, cohérent avec la recrudescence d’événements cévenols à l’automne et de perturbations orographiques renforcées en flux de sud [@Fresnay2012]. AROME sous‑diagnostique ces hausses mais en reproduit la localisation, suggérant que la dynamique (canalisation méridienne et levée orographique) est correctement simulée, tandis que l’intensité convective demeure sous‑résolue. @Ribes2019 met en évidence que cette zone cumule le plus fort renforcement observé sur l’ensemble du Midi méditerranéen avec un gain d'intensité moyen de +22% des précipitations extrêmes journalières entre 1961 et 2015. Ils mettent en évidence sur la moitié sud‑est, incluant Gard, Ardèche et Drôme, un doublement de la fréquence des évènements >200 mm en 24h depuis 1985 avec la plupart associés à des pics horaires >50 mm. @blanchet2021explaining montrent que, depuis les années 1980, l’influence méditerranéenne automnale s’est nettement intensifiée et avancée dans la saison, avec les hausses de niveaux de retour les plus fortes centrées sur le sillon Rhône‑Alpes et les Cévennes. Ce « hot‑spot » est flagrant à l'échelle nationale pour les données horaires en février. Depuis le début des années 1990, la température moyenne des mois d'hiver en France a gagné +0,8°C (différence entre les normales 1961‑1990 et 1991‑2020 de Météo‑France) — soit un pouvoir de rétention d’humidité supplémentaire d’environ +6% selon la relation de Clausius‑Clapeyron. Trois leviers pourraient se cumuler en février : 1) la pluie remplace la neige, concentrant la lame d’eau [@ZAQOUT2024131439] ; 2) il existe des pentes de 12%/°C pour les extrêmes horaires lorsque T = 0–8°C — soit presque le double des 7% classiques [@Drobinski2016] ; et 3) des flux de sud plus humides injectent davantage de vapeur dans un couloir orographique très efficace [@LorentePlazas2020].\n",
        "\n",
        "\n",
        "## Conclusion\n",
        "\n",
        "L’évaluation conduite sur les précipitations en France montre que le modèle AROME (2,5 km, forcé par ERA5) restitue correctement les grands régimes pluviométriques observés. La climatologie simulée reproduit les contrastes majeurs du territoire : excédent orographique sur les reliefs, gradient atlantique–continental à l’ouest et déficit fréquentiel sur le pourtour méditerranéen. Cette cohérence confirme que les principaux forçages dynamiques (flux d’ouest, soulèvements orographiques, circulations méditerranéennes de basse couche) sont bien représentés. Cependant, la comparaison avec les observations révèle des **biais locaux notables**. Le modèle surestime la fréquence et les cumuls dans certains reliefs (Massif central, Pyrénées, Chamonix), et sous-estime systématiquement les extrêmes dans les Alpes du Nord, l’Alsace, la côte basque et la vallée du Rhône. Aux échelles extrêmes, les écarts atteignent −5 à −20 mm/j pour les maxima journaliers et −5 à −10 mm/h pour les maxima horaires, avec une sous-représentation marquée des événements convectifs estivaux (biais saisonnier de −3,7 mm/h en été contre −0,02 mm/h en hiver). Malgré ces écarts en valeur absolue, la corrélation spatiale reste élevée (r = 0,9 au pas journalier et 0,7–0,8 au pas horaire), montrant que la structure spatiale des précipitations est globalement captée, mais que leur intensité est aplatie. \\\n",
        "\n",
        "L’analyse des **tendances** apporte un diagnostic contrasté. À l’échelle journalière (1959–2022), les tendances positives observées dans le sud-est (Mercantour, vallée du Rhône) ou sur la moitié nord concordent avec les signaux déjà documentés, mais AROME sous-estime leur amplitude de 2 à 5 % en moyenne. À l’échelle horaire (1990–2022), les signaux apparaissent plus hétérogènes, souvent non significatifs et faiblement corrélés aux observations. Ils montrent que si des **indices locaux d’intensification existent** (vallée du Rhône en hiver, arc méditerranéen au printemps et en automne), ils restent noyés dans le bruit de la variabilité convective et ne permettent pas de conclure à une tendance généralisée. Ce constat rejoint la littérature internationale qui souligne la difficulté d’inférer des tendances robustes sur les extrêmes infra-journaliers, en raison de la longueur limitée des séries et de l’hétérogénéité des processus convectifs. En définitive, l’étude confirme que les modèles à convection explicite comme AROME constituent un progrès net pour la représentation spatiale des extrêmes et leur évaluation sur de longues périodes, mais qu’ils peinent encore à reproduire l’intensité et l’évolution des précipitations horaires extrêmes.\n",
        " \n",
        "## Remerciements {.unnumbered}\n",
        "\n",
        "Je tiens à remercier Juliette Blanchet et Antoine Blanc pour l'encadrement rigoureux, stimulant et bienveillant tout au long de ce stage. Leurs conseils avisés, leur disponibilité constante et leurs nombreuses remarques constructives m'ont permis d’approfondir considérablement mes compétences scientifiques et méthodologiques.\n",
        "\n",
        "\n",
        "## References {.unnumbered}\n",
        "\n",
        ":::{#refs}\n",
        "\n",
        ":::\n",
        "\n",
        "\n",
        "\n",
        "## Annexes 1 : formules mathématiques {.unnumbered}\n",
        "\n",
        "### A.1.1. Obtention de (1)  {.unnumbered}\n",
        "\n",
        "\n",
        "Soit la fonction de vraisemblance ${\\displaystyle {\\mathcal {L}}(\\theta ;x)} : {\\displaystyle \\theta \\mapsto f(x;\\theta )}$. Alors : ${\\displaystyle \\log {\\mathcal {L}}(\\theta ;x_{1},x_{2},\\dots ,x_{n})=\\sum _{i=1}^{n}\\log {\\mathcal {L}}(\\theta ;x_{i})}$.\n",
        "\n",
        "Pour $1 + \\xi \\frac{x - \\mu}{\\sigma} > 0$, avec $\\sigma > 0$ :\n",
        "\n",
        "$$\n",
        "\\begin{aligned}\n",
        "\\log \\mathcal{L}(\\theta)\n",
        "&= \\sum_{i=1}^n \\left[\n",
        "  -\\log \\sigma\n",
        "  - \\frac{1 + \\xi}{\\xi} \\log\\left(1 + \\xi \\frac{x_i - \\mu}{\\sigma} \\right)\n",
        "  - \\left(1 + \\xi \\frac{x_i - \\mu}{\\sigma} \\right)^{-\\frac{1}{\\xi}}\n",
        "\\right] \\\\\n",
        "\\log \\mathcal{L}(\\theta)\n",
        "&= -n \\log \\sigma\n",
        "- \\left(1 + \\frac{1}{\\xi}\\right) \\sum_{i=1}^n \\log\\left(1 + \\xi \\frac{x_i - \\mu}{\\sigma} \\right)\n",
        "- \\sum_{i=1}^n \\left(1 + \\xi \\frac{x_i - \\mu}{\\sigma} \\right)^{-\\frac{1}{\\xi}}\n",
        "\\end{aligned}\n",
        "$$\n",
        "\n",
        "La log-vraisemblance $\\ell(\\theta) = \\log \\mathcal{L}(\\theta)$ s’écrit alors :\n",
        "\n",
        "$$\n",
        "\\ell(\\theta)=\n",
        "-\\sum_{i=1}^n\\Bigl[\n",
        "\\log\\sigma\n",
        "+\\Bigl(1+\\tfrac1{\\xi}\\Bigr)\\log (1+\\xi\\;\\frac{x_i-\\mu}{\\sigma})\n",
        "+(1+\\xi\\;\\frac{x_i-\\mu}{\\sigma})^{-\\frac{1}{\\xi}}\n",
        "\\Bigr]\n",
        "\\tag{1}\n",
        "$$\n",
        "\n",
        "### A.1.2. Obtention des paramètres  {.unnumbered}\n",
        "\n",
        "$\\mu_1(z_{T,1})$ et $\\sigma_1(z_{T,1})$\n",
        "\n",
        "\n",
        "En développant les paramètres soumis à un effet temporel, on a :\n",
        "\n",
        "$$\n",
        "\\begin{aligned}\n",
        "\\mu_0 + \\mu_1 t &= z_{T,0} + z_{T,1} t - \\dfrac{\\sigma_0 + \\sigma_1 t}{\\xi_0} \\left[ \\left( -\\log\\left(1 - \\frac{1}{T} \\right) \\right)^{-\\xi_0} - 1 \\right]\\\\\n",
        "\\mu_0+\\mu_1\\,t &= \\Bigl[\\,z_{T,0}\n",
        "-\\dfrac{\\sigma_0}{\\xi_0}\\Bigl(\\bigl[-\\log(1-\\tfrac1T)\\bigr]^{-\\xi_0}-1\\Bigr)\n",
        "\\Bigr]\\;+\\;\\Bigl[\\,z_{T,1}-\\dfrac{\\sigma_1}{\\xi_0}\\Bigl(\\bigl[-\\log(1-\\tfrac1T)\\bigr]^{-\\xi_0}-1\\Bigr)\\Bigr]\\,t\\\\\n",
        "\\end{aligned}\n",
        "$$\n",
        "\n",
        "c’est-à-dire, terme à terme :\n",
        "\n",
        "$$\n",
        "\\begin{aligned}\n",
        "\\mu_0 &\\;=\\; z_{T,0}\n",
        "-\\dfrac{\\sigma_0}{\\xi_0}\\Bigl(\\bigl[-\\log(1-\\tfrac1T)\\bigr]^{-\\xi_0}-1\\Bigr),\\\\[0.8em]\n",
        "\\mu_1 &\\;=\\; z_{T,1}\n",
        "-\\dfrac{\\sigma_1}{\\xi_0}\\Bigl(\\bigl[-\\log(1-\\tfrac1T)\\bigr]^{-\\xi_0}-1\\Bigr).\n",
        "\\end{aligned}\n",
        "$$\n",
        "\n",
        "## Annexes 2 : cartographie {.unnumbered}\n",
        "\n",
        "Afin d’alléger le corps du document, l’ensemble des cartes produites dans le cadre de cette étude n’est pas reproduit ici. Elles sont mises à disposition sous forme de figures rasterisées et vectorielles dans un répertoire en ligne accessible à l’adresse suivante :   \\\n",
        "\n",
        "https://ncsdecoopman.github.io/ExtremePrecipit/rapport/annexes.pdf   \\\n",
        "\n",
        "Ces annexes complémentaires permettent de visualiser l’ensemble des diagnostics spatiaux (détaillés par saison, pas de temps et indicateur) avec une possibilité de zoom pour examiner les motifs régionaux fins."
      ],
      "id": "a2122f9b"
    }
  ],
  "metadata": {
    "kernelspec": {
      "name": "python3",
      "language": "python",
      "display_name": "Python 3 (ipykernel)",
      "path": "/home/decoopmn/miniconda3/envs/extremeprecipit/share/jupyter/kernels/python3"
    }
  },
  "nbformat": 4,
  "nbformat_minor": 5
}